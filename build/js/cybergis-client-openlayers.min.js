/*! cybergis-client 10-10-2015 */
OpenLayers.Control.AdvancedChart=OpenLayers.Class(OpenLayers.Control,{daysoftheweek:["Sunday","Monday","Tuesday","Wednesday","Thursday","Friday","Saturday"],monthsoftheyear:["January","February","March","April","May","June","July","August","September","October","November","December"],type:"static",mainDiv:void 0,middle:void 0,mainLabel:void 0,listener:void 0,updateDelay:2e3,animate:!0,currentDate:void 0,currentDateRange:void 0,currentTime:void 0,currentTimeRange:void 0,timeValue:void 0,timeValues:void 0,minDate:void 0,minTime:void 0,maxDate:void 0,maxTime:void 0,days:void 0,expandedMaxWidth:380,collapsedMaxWidth:220,padding:40,layer:null,chartTitle:"Syrians in Need of Assistance",chartNotes:["<span>North Africa: Algeria, Libya, Morocco, and Tunisia</span>"],chartData:void 0,chartPadding:{vertical:16,horizontal:0},chartWidth:340,chartHeight:248,outerRadius:void 0,innerRadius:void 0,labelRadius:void 0,chartItem:void 0,chartCanvas:void 0,chartScale:void 0,labelAngleMinimum:.2,svg:void 0,pie:void 0,paths:void 0,chartTotal:void 0,chartDate:void 0,isAnimated:function(){return this.animate},getMaxWidth:function(){return OpenLayers.Element.hasClass(this.mainDiv,"expanded")?this.expandedMaxWidth:this.collapsedMaxWidth},isSingle:function(){return"single"==this.type},isRange:function(){return"range"==this.type},copyDate:function(a){return new Date(a.getFullYear(),a.getMonth(),a.getDate())},formatCurrentDate:function(a){return this.formatDate(this.getCurrentDate(),a)},formatTotalValue:function(){return this.formatNumber1(this.getTotalValue())},formatCurrentStartDate:function(a){return this.formatDate(this.getCurrentStartDate(),a)},formatCurrentEndDate:function(a){return this.formatDate(this.getCurrentEndDate(),a)},formatDate:function(a,b){return void 0==a?"":"label"==b?this.monthsoftheyear[a.getMonth()]+" "+a.getDate()+", "+a.getFullYear():"wfs"==b?a.getFullYear()+"-"+(a.getMonth()<9?"0"+(a.getMonth()+1):a.getMonth()+1)+"-"+(a.getDate()<10?"0"+a.getDate():a.getDate()):void 0},formatNumber1:function(a){for(var b=""+a,c=new RegExp("(\\d+)(\\d{3})","gi");c.test(b);)b=b.replace(c,"$1,$2");return b},formatNumber2:function(a,b){if(1e3==b||1e4==b||1e5==b){for(var c=a/1e3,d=""+c,e=new RegExp("(\\d+)(\\d{3})","gi");e.test(d);)d=d.replace(e,"$1,$2");return d+"K"}for(var d=""+a,e=new RegExp("(\\d+)(\\d{3})","gi");e.test(d);)d=d.replace(e,"$1,$2");return d},formatPercent:function(a,b,c,d){var e="";return void 0!=a&&void 0!=b&&(e=void 0==c||0>c?""+100*a/b+"%":0==c?void 0==d||1==d?""+parseInt(100*a/b)+"%":""+parseInt(100*a/b)-parseInt(100*a/b)%d+"%":(100*a/b).toFixed(c)+"%"),e},setCurrentDate:function(a){_setCurrentDate(a)},setCurrentDateRange:function(a,b){_setCurrentDateRange(a,b)},_setCurrentDate:function(a){a=this.boundDate(a),this.currentDate=a,this.currentTime=a.getTime(),this.timeValue=Math.floor((this.currentTime-this.minTime)/864e5)},_setCurrentDateRange:function(a,b){a=this.boundDate(a),b=this.boundDate(b),this.currentDateRange=[a,b];var c=a.getTime(),d=b.getTime();this.currentTimeRange=[c,d];var e=Math.floor((this.currentTimeRange[0]-this.minTime)/864e5),f=Math.floor((this.currentTimeRange[1]-this.minTime)/864e5);this.timeValues=[e,f]},_setCurrentStartDate:function(a){a=this.boundDate(a),this.currentDateRange[0]=a;var b=a.getTime();this.currentTimeRange[0]=b;var c=Math.floor((b-this.minTime)/864e5);this.timeValues[0]=c},_setCurrentEndDate:function(a){a=this.boundDate(a),this.currentDateRange[1]=a;var b=a.getTime();this.currentTimeRange[1]=b;var c=Math.floor((b-this.minTime)/864e5);this.timeValues[1]=c},boundDate:function(a){var b=void 0;return b=a.getTime()>this.getMaxTime()?this.copyDate(this.getMaxDate()):a.getTime()<this.getMinTime()?this.copyDate(this.getMinDate()):this.copyDate(a)},getCurrentDate:function(){return this.currentDate},getCurrentStartDate:function(){return void 0!=this.currentDateRange?this.currentDateRange[0]:void 0},getCurrentEndDate:function(){return void 0!=this.currentDateRange?this.currentDateRange[1]:void 0},getTimeValue:function(){return this.timeValue},getStartTimeValue:function(){return this.timeValues[0]},getEndTimeValue:function(){return this.timeValues[1]},getTimeValues:function(){return this.timeValues},getTotalValue:function(){var a=0;if(void 0!=this.layer)for(var b=this.getValueField(this.sLayer,this.sChart),c=0;c<this.layer.features.length;c++){var d=this.layer.features[c];if(void 0!=d.attributes[""+b]){var e=d.attributes[""+b],f=parseInt(e,10);a+=f}}return a},refreshChartData:function(){if(this.check_defined([this.sLayer,this.sChart])){var a=this.getLabelField(this.sLayer,this.sChart),b=this.getValueField(this.sLayer,this.sChart),c=this.getTotalValue(),d=[];if(void 0!=this.layer)for(var e=0;e<this.layer.features.length;e++){var f=this.layer.features[e],g=f.attributes[""+a],h=void 0;if(void 0!=f.attributes[""+b]){var i=f.attributes[""+b];h=parseInt(i,10)}var j={};j[""+a]=g,j[""+b]=h,j.percent=Math.floor(h/c*100),d.push(j)}this.chartData=d}else this.chartData=[];return this.chartData},refreshChartScale:function(){if(this.check_defined([this.sLayer,this.sChart])){var a=this.getBarRange(this.sLayer,this.sChart);return this.chartScale=d3.scale.linear().domain(a).rangeRound([this.chartHeight-2*this.chartPadding.vertical,0]),this.chartScale}return this.chartScale=void 0,this.chartScale},getMinDate:function(){return this.minDate},getMinTime:function(){return this.minTime},getMaxDate:function(){return this.maxDate},getMaxTime:function(){return this.maxTime},getDays:function(){return this.days},setDateRange:function(a,b){this.minDate=a,this.minTime=a.getTime(),this.maxDate=b,this.maxTime=b.getTime(),this.days=Math.floor((this.maxTime-this.minTime)/864e5+1)},collapse:function(){if(this.collapseTimer=void 0,OpenLayers.Element.hasClass(this.mainDiv,"expanded")&&OpenLayers.Element.removeClass(this.mainDiv,"expanded"),$(this.mainDiv).stop(!0,!1),this.isAnimated()){var a=this.map,b=Math.min(a.getCurrentSize().w-this.padding,this.getMaxWidth()),c=-1*(b/2)-this.padding/4;$(this.mainDiv).animate({width:b,"margin-left":c})}},expand:function(){if(OpenLayers.Element.hasClass(this.mainDiv,"expanded")||OpenLayers.Element.addClass(this.mainDiv,"expanded"),$(this.mainDiv).stop(!0,!1),this.isAnimated()){var a=this.map,b=Math.min(a.getCurrentSize().w-this.padding,this.getMaxWidth()),c=-1*(b/2)-this.padding/4;$(this.mainDiv).animate({width:b,"margin-left":c})}},setLayer:function(a){var b=this;this.layer=a,this.layer.events.register("loadend",this.layer,function(){b.refresh.apply(b)})},initialize:function(a,b,c,d){OpenLayers.Control.prototype.initialize.apply(this,[d]);try{this.setLayer(a),this.sLayer=b,this.sChart=c,this.initializeDateRange(),this.initializeCurrentDate();var e=this.getValueField(this.sLayer,this.sChart);"undefined"!=typeof d3&&(this.pie=d3.layout.pie().value(function(a){return a[""+e]}),this.outerRadius=Math.min(this.chartWidth-70-10-2*this.chartPadding.horizontal,this.chartHeight-2*this.chartPadding.vertical)/2,this.innerRadius=0,this.labelRadius=this.outerRadius+4,this.arc=d3.svg.arc().innerRadius(this.innerRadius).outerRadius(this.outerRadius))}catch(f){throw console.log(f),f}},initializeDateRange:function(){var a=this.getMinDate(),b=this.getMaxDate();if(void 0==a||void 0==b){var c=new Date,d=new Date(c.getFullYear(),c.getMonth(),c.getDate());a=new Date(d.getFullYear(),d.getMonth(),d.getDate()-7),b=new Date(d.getFullYear(),d.getMonth(),d.getDate())}this.setDateRange(a,b)},initializeCurrentDate:function(){if(this.isSingle()){var a=this.getCurrentDate();void 0==a&&(a=this.copyDate(this.maxDate)),this._setCurrentDate(a)}else if(this.isRange()){var b=this.getCurrentStartDate(),c=this.getCurrentEndDate();(void 0==b||void 0==c)&&(b=new Date(this.maxDate.getFullYear(),this.maxDate.getMonth(),this.maxDate.getDate()-7),c=this.copyDate(this.maxDate)),this._setCurrentDateRange(b,c)}},draw:function(){var a=OpenLayers.Control.prototype.draw.apply(this);this.isSingle()?OpenLayers.Element.addClass(a,"single"):this.isRange()&&OpenLayers.Element.addClass(a,"range");var b=document.createElement("div");b.className="olControlAdvancedChartMiddle olControlMiddle";var c=document.createElement("div");c.className="olControlAdvancedChartLabel",$(c).data("olControlAdvancedChart",this);var d=document.createElement("span");d.innerHTML="Chart - Click to Open",c.appendChild(d),b.appendChild(c);var e=document.createElement("div");e.className="olControlAdvancedChartContainer";var f=this.createChartHeading();$(f).data("olControlAdvancedChart",this),$(f).click(function(){var a=$(this).data("olControlAdvancedChart");a.onChartHeadingClick.apply(a)}),e.appendChild(f);var g=this.createChartTitle(this.chartTitle);$(g).data("olControlAdvancedChart",this),e.appendChild(g),this.chartItem=this.createChartItem(),$(this.chartItem).data("olControlAdvancedChart",this),e.appendChild(this.chartItem),"undefined"!=typeof d3&&(this.chartCanvas=this.createChartCanvas(this.chartItem),this.refreshChartData(),this.refreshChartScale(),this.createBarChart(this.chartCanvas),this.createPieChart(this.chartCanvas)),this.chartTotal=this.createChartTotal(),$(this.chartTotal).data("olControlAdvancedChart",this),e.appendChild(this.chartTotal),this.chartDate=this.createChartDate(),$(this.chartDate).data("olControlAdvancedChart",this),e.appendChild(this.chartDate);for(var h=this.createChartNotes(this.chartNotes),i=0;i<h.length;i++){var j=h[i];$(j).data("olControlAdvancedChart",this),e.appendChild(j)}return b.appendChild(e),a.appendChild(b),this.mainDiv=a,$(c).click(function(){var a=$(this).data("olControlAdvancedChart");a.onMainLabelClick.apply(a)}),a},refresh:function(){this.refreshChartDate(),this.refreshChartTotal(),this.refreshChartData(),this.refreshChartScale(),this.refreshBarChart(),this.refreshPieChart()},refreshBarChart:function(){var a=this.getTotalValue();this.chartCanvas.selectAll("rect").transition().attr("y",this.chartScale(a)).attr("height",this.chartScale(0)-this.chartScale(a))},refreshPieChart:function(){var a=this.chartCanvas.selectAll("g.pie");a.selectAll("g.arc, g.label").data([]).exit().remove(),this.appendPieChartPaths(this.chartCanvas,a,this.arc,this.chartData),this.appendPieChartLabels(this.chartCanvas,a,this.arc,this.chartData)},refreshChartDate:function(){var a='<span style="font-weight:700;">Date:</b> </span><span>'+this.formatCurrentDate("label")+"</span>";$(".olControlAdvancedChartDate",this.chartDate).html("<span>"+a+"</span>")},refreshChartTotal:function(){var a="<span>Total:</b> </span><span>"+this.formatTotalValue()+"</span>";$(".olControlAdvancedChartTotal",this.chartTotal).html("<span>"+a+"</span>")},onChartHeadingClick:function(){this.isAnimated()?this.expand():OpenLayers.Element.hasClass(this.mainDiv,"collapsed")||OpenLayers.Element.addClass(this.mainDiv,"collapsed")},onMainLabelClick:function(){this.isAnimated()?this.expand():OpenLayers.Element.hasClass(this.mainDiv,"collapsed")&&OpenLayers.Element.removeClass(this.mainDiv,"collapsed")},onMapResize:function(){this._resizeCanvas(!0)},_resizeCanvas:function(a){var b=this.map.getCurrentSize().w,c=this.map.getCurrentSize().h,d=this.getMaximumChartWidth(b),e=this.getMaximumChartHeight(c),f=this,g=this.getTotalValue(),h=this.chartWidth,i=this.chartHeight,j=(this.getChartGap(void 0),this.chartScale(g)),k=this.chartScale(0)-this.chartScale(g);this.chartWidth=d,this.chartHeight=e;this.refreshChartScale();if(this.outerRadius=Math.min(this.chartWidth-70-this.getChartGap(b)-2*this.chartPadding.horizontal,this.chartHeight-2*this.chartPadding.vertical)/2,this.innerRadius=0,this.labelRadius=this.outerRadius+4,a){this.chartCanvas.selectAll("g.bar g.y.axis").remove(),this.chartCanvas.selectAll("g.bar").append("g").attr("class","y axis").call(d3.svg.axis().scale(this.chartScale).orient("left"));var l=this._resizeSVG(h,f.chartWidth,i,f.chartHeight);this._resizeBar(j,f.chartScale(g),k,f.chartScale(0)-f.chartScale(g),l),this._resizePie(h,f.chartWidth,i,f.chartHeight,this.arc.outerRadius()(),this.outerRadius,this.getChartGap(void 0),this.arc,this.labelAngleMinimum,this.labelRadius,l)}else this.arc=d3.svg.arc().innerRadius(this.innerRadius).outerRadius(this.outerRadius),this.refreshChartScale(),this.refreshBarChart()},getChartGap:function(a){return 10},getMaximumChartWidth:function(a){var b=340;return void 0!=a&&(b=a>1e3?340:240),b},getMaximumChartHeight:function(a){var b=248;return void 0!=a&&(b=a>700?248:a>360?168:138),b},_resizeSVG:function(a,b,c,d){var e=this.chartCanvas.data(this.chartData).transition().delay(300).duration(500).tween("dims",function(e,f,g){var h=d3.interpolate(a,b),i=d3.interpolate(c,d);return function(a){var b=h(a),c=i(a);d3.select(this).attr({width:b,height:c})}});return e},_resizeBar:function(a,b,c,d,e){var f=e.selectAll("g.bar rect").tween("dims",function(e,f,g){var h=d3.interpolate(a,b),i=d3.interpolate(c,d);return function(a){var b=h(a),c=i(a);d3.select(this).attr({y:b,height:c})}});return f},_resizePie:function(a,b,c,d,e,f,g,h,i,j,k){k.selectAll("g.pie").attrTween("transform",function(h,i,j){var k=d3.interpolate(e,f),l=d3.interpolate(a,b),m=d3.interpolate(c,d);return function(a){var b=k(a),c=(l(a),m(a));return"translate("+(70+g+b)+","+c/2+")"}}).selectAll("g.arc path").attrTween("d",function(a,b,c){var d=d3.interpolate(this._current,a),g=d3.interpolate(e,f);return this._current=d(0),function(a){return h.outerRadius(g(a))(d(a))}});k.selectAll("g.pie g.label").tween("labels",function(a,b,c){var d=d3.interpolate(this._current,a),g=d3.interpolate(e,f);return a.endAngle-a.startAngle<i?function(a){var b=d(a),c=g(a),e=h.outerRadius(c)(b),f=d3.svg.arc().innerRadius(0).outerRadius(c),i=f.centroid(b),k=i[0],l=i[1],m=Math.sqrt(k*k+l*l),n=k/m*j,o=l/m*j;d3.select(this).select("path").attr({d:e}),d3.select(this).select("text").attr("transform","translate("+n+","+o+")")}:function(a){var b=d(a),c=g(a),e=h.outerRadius(c)(b);d3.select(this).select("path").attr({d:e}),d3.select(this).select("text").attr({transform:"translate("+h.centroid(b)+")"})}})},onPathOver:function(a){d3.select(a).transition().duration(500).attr("fill","#A88B77")},onPathOut:function(a){d3.select(a).transition().duration(500).attr("fill","#bca295")},createChartHeading:function(){var a=document.createElement("div");a.className="olControlAdvancedChartItem";var b=document.createElement("div");return b.className="olControlAdvancedChartHeading",$(b).html("<div><span>Chart</span></div>"),a.appendChild(b),a},createChartTitle:function(a){var b=document.createElement("div");b.className="olControlAdvancedChartItem";var c=document.createElement("div");return c.className="olControlAdvancedChartTitle",$(c).html("<div><span>"+a+"</span></div>"),b.appendChild(c),b},createChartNotes:function(a){for(var b=[],c=0;c<a.length;c++)b.push(this.createChartNote(a[c]));return b},createChartNote:function(a){var b=document.createElement("div");b.className="olControlAdvancedChartItem";var c=document.createElement("div");return c.className="olControlAdvancedChartNote",$(c).html("<span>"+a+"</span>"),b.appendChild(c),b},createChartDate:function(){var a='<span style="font-weight:700;">Date:</b> </span><span>'+this.formatCurrentDate("label")+"</span>",b=document.createElement("div");b.className="olControlAdvancedChartItem";var c=document.createElement("div");return c.className="olControlAdvancedChartDate",$(c).html("<span>"+a+"</span>"),b.appendChild(c),b},createChartTotal:function(){var a="<span>Total:</b> </span><span>"+this.formatTotalValue()+"</span>",b=document.createElement("div");b.className="olControlAdvancedChartItem";var c=document.createElement("div");return c.className="olControlAdvancedChartTotal",$(c).html("<span>"+a+"</span>"),b.appendChild(c),b},createChartItem:function(){var a=document.createElement("div");return a.className="olControlAdvancedChartItem",$(a).css("height","auto"),a},createChartCanvas:function(a){var b=void 0;try{b=d3.select(a).append("svg").attr("width",this.chartWidth).attr("height",this.chartHeight)}catch(c){throw console.log(c),c}return b},createBarChart:function(a){try{this.appendBarChart(a,this.chartData,this.chartScale)}catch(b){throw console.log(b),b}},createPieChart:function(a){try{var b=a.append("g").attr("class","pie").attr("transform","translate("+(70+this.getChartGap(void 0)+this.outerRadius)+","+this.chartHeight/2+")");this.appendPieChartPaths(a,b,this.arc,this.chartData),this.appendPieChartLabels(a,b,this.arc,this.chartData)}catch(c){throw console.log(c),c}},appendBarChart:function(a,b,c){var d=a.append("g").attr("class","bar").attr("transform","translate(50,"+this.chartPadding.vertical+")"),e=d3.svg.axis().scale(c).orient("left");d.append("g").attr("class","y axis").call(e),d.append("rect").attr("x",4).attr("width",16).attr("y",this.chartHeight-2*this.chartPadding.vertical).attr("height",0).style("fill","#bca295")},appendPieChartPaths:function(a,b,c,d){var e=this,f=(this.getLabelField(this.sLayer,this.sChart),this.getValueField(this.sLayer,this.sChart)),g=b.selectAll("g.arc").data(this.pie(d)).enter().append("g").attr("class","arc");g.each(function(a){this._current=a}),g.append("title").text(function(a){return a.data[""+f]+" ("+a.data.percent+"%)"}),g.append("path").attr("d",c).attr("fill","#bca295").on("mouseover",function(){e.onPathOver(this)}).on("mouseout",function(){e.onPathOut(this)}).each(function(a){this._current=a})},appendPieChartLabels:function(a,b,c,d){var e=this.getLabelField(this.sLayer,this.sChart),f=(this.getValueField(this.sLayer,this.sChart),b.selectAll("g.label").data(this.pie(d)).enter().append("g").attr("class","label"));f.each(function(a){this._current=a}),f.append("path").attr("d",c).attr("display","none").each(function(a){this._current=a}),this.appendTextElements(c,f,"base",function(a,b){return a.data[""+e]}),this.appendTextElements(c,f,"print",function(a,b){return a.data.percent+"%"},"18")},appendTextElements:function(a,b,c,d,e){var f=this,g=b.append("text").attr("class",c).attr("text-anchor",function(a){return a.endAngle-a.startAngle<f.labelAngleMinimum?(a.endAngle+a.startAngle)/2>Math.PI?"end":"start":"middle"}).attr("transform",function(b){if(b.endAngle-b.startAngle<f.labelAngleMinimum){var c=a.centroid(b),d=c[0],e=c[1],g=Math.sqrt(d*d+e*e);return"translate("+d/g*f.labelRadius+","+e/g*f.labelRadius+")"}return"translate("+a.centroid(b)+")"}).style("pointer-events","none").text(d);void 0!=e&&g.attr("dy",e)},hasChartItem:function(a){var b=!1;return void 0!=this.carto&&void 0!=this.carto.layers&&void 0!=this.carto.layers[""+a]&&(b=void 0!=this.carto.layers[""+a].chart),b},getLabelField:function(a,b){var c=!1;return void 0!=this.carto&&void 0!=this.carto.layers&&void 0!=this.carto.layers[""+a]&&void 0!=this.carto.layers[""+a].charts&&void 0!=this.carto.layers[""+a].charts[b]&&void 0!=this.carto.layers[""+a].charts[b].label&&(c=this.carto.layers[""+a].charts[b].label),c},getValueField:function(a,b){var c=!1;return void 0!=this.carto&&void 0!=this.carto.layers&&void 0!=this.carto.layers[""+a]&&void 0!=this.carto.layers[""+a].charts&&void 0!=this.carto.layers[""+a].charts[b]&&void 0!=this.carto.layers[""+a].charts[b].value&&(c=this.carto.layers[""+a].charts[b].value),c},getBarRange:function(a,b){var c=!1;return this.check_defined([a,b])&&void 0!=this.carto&&void 0!=this.carto.layers&&void 0!=this.carto.layers[""+a]&&void 0!=this.carto.layers[""+a].charts&&void 0!=this.carto.layers[""+a].charts[b]&&void 0!=this.carto.layers[""+a].charts[b].bar&&void 0!=this.carto.layers[""+a].charts[b].bar.range&&(c=this.carto.layers[""+a].charts[b].bar.range),c},check_defined:function(a){for(var b=!0,c=0;c<a.length;c++)if(void 0==a[c]){b=!1;break}return b},destroy:function(){this.sliderEvents.un({touchstart:this.zoomBarDown,touchmove:this.zoomBarDrag,touchend:this.zoomBarUp,mousedown:this.zoomBarDown,mousemove:this.zoomBarDrag,mouseup:this.zoomBarUp}),this.sliderEvents.destroy()},CLASS_NAME:"OpenLayers.Control.AdvancedChart"}),OpenLayers.Control.AdvancedLegend=OpenLayers.Class(OpenLayers.Control,{daysoftheweek:["Sunday","Monday","Tuesday","Wednesday","Thursday","Friday","Saturday"],monthsoftheyear:["January","February","March","April","May","June","July","August","September","October","November","December"],type:"static",mainDiv:void 0,middle:void 0,mainLabel:void 0,listener:void 0,updateDelay:2e3,animate:!0,currentDate:void 0,currentDateRange:void 0,currentTime:void 0,currentTimeRange:void 0,value:void 0,values:void 0,minDate:void 0,minTime:void 0,maxDate:void 0,maxTime:void 0,days:void 0,expandedMaxWidth:380,collapsedMaxWidth:220,padding:20,layer:null,layers:null,bHide:!1,bFade:!0,legendItems:void 0,isAnimated:function(){return this.animate},getMaxWidth:function(){return OpenLayers.Element.hasClass(this.mainDiv,"expanded")?this.expandedMaxWidth:this.collapsedMaxWidth},setLayer:function(a){var b=this;this.layer=a,a.events.register("loadend",a,function(){b.refresh.apply(b)})},setLayers:function(a){var b=this;this.layers=a;for(var c=0;c<a.length;c++){var d=a[c];d.events.register("loadend",d,function(){b.refresh.apply(b)})}},setMap:function(a){OpenLayers.Control.prototype.setMap.apply(this,[a]);var b=this;if(void 0!=this.layers)for(var c=0;c<this.layers.length;c++)a.events.register("zoomend",this.layers[c],function(){b.refresh.apply(b)});else a.events.register("zoomend",this.layer,function(){b.refresh.apply(b)})},createLegend:function(){this.createHeading(this.legendContainer),void 0!=this.layer?this.createLayer(this.layer,this.legendContainer):void 0!=this.layers&&this.createLayers(this.layers,this.legendContainer)},createHeading:function(a){var b=this.createLegendHeading();$(b).data("olControlAdvancedLegend",this),$(b).click(function(){var a=$(this).data("olControlAdvancedLegend");a.onLegendHeadingClick.apply(a)}),a.appendChild(b)},createLayers:function(a,b){for(var c=0;c<a.length;c++)this.createLayer(a[c],b,c+1>=a.length?void 0:a[c+1])},createLayer:function(a,b,c){if(this.hasLegendItem(a.proto)){for(var d=this.createLegendItems(a.proto,a.inRange,void 0!=c?c.proto:void 0),e=0;e<d.length;e++)b.appendChild(d[e]);this.setLegendItems(a.proto,d)}},refresh:function(){void 0!=this.layer?this.refreshLayer(this.layer,this.legendContainer):void 0!=this.layers&&this.refreshLayers(this.layers,this.legendContainer)},refreshLayers:function(a,b){for(var c=0;c<a.length;c++)this.refreshLayer(a[c],b)},refreshLayer:function(a,b){if(void 0!=this.legendItems){var c=this.legendItems[""+a.proto];if(void 0!=c&&c.length>0)for(var d=0;d<c.length;d++)a.inRange?$(c[d]).removeClass("hidden fade"):this.bHide?($(c[d]).removeClass("fade"),$(c[d]).addClass("hidden")):this.bFade?($(c[d]).removeClass("hidden"),$(c[d]).addClass("fade")):$(c[d]).removeClass("hidden fade")}},setLegendItems:function(a,b){void 0==this.legendItems&&(this.legendItems={}),this.legendItems[""+a]=b},isSingle:function(){return"single"==this.type},isRange:function(){return"range"==this.type},copyDate:function(a){return new Date(a.getFullYear(),a.getMonth(),a.getDate())},formatCurrentDate:function(a){return this.formatDate(this.getCurrentDate(),a)},formatCurrentStartDate:function(a){return this.formatDate(this.getCurrentStartDate(),a)},formatCurrentEndDate:function(a){return this.formatDate(this.getCurrentEndDate(),a)},formatDate:function(a,b){return void 0==a?"":"label"==b?this.monthsoftheyear[a.getMonth()]+" "+a.getDate()+", "+a.getFullYear():"wfs"==b?a.getFullYear()+"-"+(a.getMonth()<9?"0"+(a.getMonth()+1):a.getMonth()+1)+"-"+(a.getDate()<10?"0"+a.getDate():a.getDate()):void 0},setCurrentDate:function(a,b){_setCurrentDate(a),b&&this._updateUI()},setCurrentDateRange:function(a,b,c){_setCurrentDateRange(a,b),c&&this._updateUI()},_setCurrentDate:function(a){a=this.boundDate(a),this.currentDate=a,this.currentTime=a.getTime(),this.value=Math.floor((this.currentTime-this.minTime)/864e5)},_setCurrentDateRange:function(a,b){a=this.boundDate(a),b=this.boundDate(b),this.currentDateRange=[a,b];var c=a.getTime(),d=b.getTime();this.currentTimeRange=[c,d];var e=Math.floor((this.currentTimeRange[0]-this.minTime)/864e5),f=Math.floor((this.currentTimeRange[1]-this.minTime)/864e5);this.values=[e,f]},_setCurrentStartDate:function(a){a=this.boundDate(a),this.currentDateRange[0]=a;var b=a.getTime();this.currentTimeRange[0]=b;var c=Math.floor((b-this.minTime)/864e5);this.values[0]=c},_setCurrentEndDate:function(a){a=this.boundDate(a),this.currentDateRange[1]=a;var b=a.getTime();this.currentTimeRange[1]=b;var c=Math.floor((b-this.minTime)/864e5);this.values[1]=c},boundDate:function(a){var b=void 0;return b=a.getTime()>this.getMaxTime()?this.copyDate(this.getMaxDate()):a.getTime()<this.getMinTime()?this.copyDate(this.getMinDate()):this.copyDate(a)},getCurrentDate:function(){return this.currentDate},getCurrentStartDate:function(){return void 0!=this.currentDateRange?this.currentDateRange[0]:void 0},getCurrentEndDate:function(){return void 0!=this.currentDateRange?this.currentDateRange[1]:void 0},getValue:function(){return this.value},getStartValue:function(){return this.values[0]},getEndValue:function(){return this.values[1]},getValues:function(){return this.values},getMinDate:function(){return this.minDate},getMinTime:function(){return this.minTime},getMaxDate:function(){return this.maxDate},getMaxTime:function(){return this.maxTime},getDays:function(){return this.days},getUpdateDelay:function(){return this.updateDelay()},setUpdateDelay:function(a){this.updateDelay=a},setDateRange:function(a,b){this.minDate=a,this.minTime=a.getTime(),this.maxDate=b,this.maxTime=b.getTime(),this.days=Math.floor((this.maxTime-this.minTime)/864e5+1)},collapse:function(){if(this.collapseTimer=void 0,OpenLayers.Element.hasClass(this.mainDiv,"expanded")&&OpenLayers.Element.removeClass(this.mainDiv,"expanded"),$(this.mainDiv).stop(!0,!1),this.isAnimated()){var a=this.map,b=Math.min(a.getCurrentSize().w-this.padding,this.getMaxWidth()),c=-1*(b/2)-this.padding/4;$(this.mainDiv).animate({width:b,"margin-left":c})}else this._resizeSlider()},expand:function(){if(OpenLayers.Element.hasClass(this.mainDiv,"expanded")||OpenLayers.Element.addClass(this.mainDiv,"expanded"),$(this.mainDiv).stop(!0,!1),this.isAnimated()){var a=this.map,b=Math.min(a.getCurrentSize().w-this.padding,this.getMaxWidth()),c=-1*(b/2)-this.padding/4;$(this.mainDiv).animate({width:b,"margin-left":c})}else this._resizeSlider()},initialize:function(a,b){OpenLayers.Control.prototype.initialize.apply(this,[b]),OpenLayers.Util.isArray(a)?this.setLayers(a):this.setLayer(a),this.initializeDateRange(),this.initializeCurrentDate()},initializeDateRange:function(){var a=this.getMinDate(),b=this.getMaxDate();if(void 0==a||void 0==b){var c=new Date,d=new Date(c.getFullYear(),c.getMonth(),c.getDate());a=new Date(d.getFullYear(),d.getMonth(),d.getDate()-7),b=new Date(d.getFullYear(),d.getMonth(),d.getDate())}this.setDateRange(a,b)},initializeCurrentDate:function(){if(this.isSingle()){var a=this.getCurrentDate();void 0==a&&(a=this.copyDate(this.maxDate)),this._setCurrentDate(a)}else if(this.isRange()){var b=this.getCurrentStartDate(),c=this.getCurrentEndDate();(void 0==b||void 0==c)&&(b=new Date(this.maxDate.getFullYear(),this.maxDate.getMonth(),this.maxDate.getDate()-7),c=this.copyDate(this.maxDate)),this._setCurrentDateRange(b,c)}},draw:function(){var a=OpenLayers.Control.prototype.draw.apply(this);this.isSingle()?OpenLayers.Element.addClass(a,"single"):this.isRange()&&OpenLayers.Element.addClass(a,"range");var b=document.createElement("div");b.className="olControlAdvancedLegendMiddle olControlMiddle";var c=document.createElement("div");c.className="olControlAdvancedLegendLabel",$(c).data("olControlAdvancedLegend",this);var d=document.createElement("span");return d.innerHTML="Legend - Click to Open",c.appendChild(d),b.appendChild(c),this.legendContainer=document.createElement("div"),this.legendContainer.className="olControlAdvancedLegendContainer",this.createLegend(),b.appendChild(this.legendContainer),a.appendChild(b),this.mainDiv=a,$(c).click(function(){var a=$(this).data("olControlAdvancedLegend");a.onMainLabelClick.apply(a)}),a},onLegendHeadingClick:function(){this.isAnimated()?this.collapse():OpenLayers.Element.hasClass(this.mainDiv,"collapsed")||OpenLayers.Element.addClass(this.mainDiv,"collapsed")},onMainLabelClick:function(){this.isAnimated()?this.expand():OpenLayers.Element.hasClass(this.mainDiv,"collapsed")&&OpenLayers.Element.removeClass(this.mainDiv,"collapsed")},onMapResize:function(){this._resizeLegend()},_resizeLegend:function(){},createLegendItems:function(a,b,c){var d=[];if(this.hasClassification(a,"basic")){var e=this.getDefaultLegendClassifier(a,"basic"),f=this.getClassNames(a,e);if(0==f.length)d.push(this.createLegendItem({sLayer:a,inRange:b}));else if(1==f.length)d.push(this.createLegendItem({sLayer:a,iClassifier:e,sClass:f[0],inRange:b}));else{d.push(this.createLegendSubHeading(a));for(var g=0;g<f.length;g++)d.push(this.createLegendItem({sLayer:a,iClassifier:e,sClass:f[g],inRange:b}));void 0!=c&&d.push(this.createLegendBreak())}}else d.push(this.createLegendItem({sLayer:a,inRange:b})),void 0!=c&&this.hasClassification(c,"basic")&&this.getClassNames(c,this.getDefaultLegendClassifier(c,"basic")).length>1&&d.push(this.createLegendBreak());return d},createLegendItem:function(a){var b=a.sLayer,c=a.iClassifier,d=a.sClass,e=a.inRange,f=document.createElement("div");if(e?f.className="olControlAdvancedLegendItem":this.bHide?f.className="olControlAdvancedLegendItem hidden":this.bFade?f.className="olControlAdvancedLegendItem fade":f.className="olControlAdvancedLegendItem",void 0==d){var g=this.getSymbolType(b);void 0!=g&&f.appendChild(this.createLegendItemSymbol({sLayer:b,sType:g}));var h=this.createLegendItemLabel({sLayer:b});f.appendChild(h)}else{var g=this.getSymbolType(b);void 0!=g&&f.appendChild(this.createLegendItemSymbol({sLayer:b,iClassifier:c,sClass:d,sType:g}));var h=this.createLegendItemLabel({sLayer:b,iClassifier:c,sClass:d});f.appendChild(h)}return f},createLegendBreak:function(){var a=document.createElement("div");a.className="olControlAdvancedLegendBreak";var b=document.createElement("div");return a.appendChild(b),a},createLegendSubHeading:function(a){var b=document.createElement("div");b.className="olControlAdvancedLegendItem";var c=document.createElement("div");return c.className="olControlAdvancedLegendSubHeading",$(c).html("<div><span>"+this.getDefaultLabel(a)+"</span></div>"),b.appendChild(c),b},createLegendHeading:function(){var a=document.createElement("div");a.className="olControlAdvancedLegendItem",$(a).css("height","auto");var b=document.createElement("div");return b.className="olControlAdvancedLegendHeading",$(b).html("<div><span>Legend</span></div>"),a.appendChild(b),a},createLegendItemLabel:function(a){var b=a.sLayer,c=a.iClassifier,d=a.sClass,e=document.createElement("div");return e.className="olControlAdvancedLegendItemLabel",void 0==d?$(e).html("<div><span>"+this.getDefaultLabel(b)+"</span></div>"):$(e).html("<div><span>"+this.getClassLabel(b,c,d)+"</span></div>"),e},createLegendItemSymbol:function(a){var b=a.sLayer,c=a.sType,d=a.iClassifier,e=a.sClass,f=document.createElement("div");if(f.className="olControlAdvancedLegendItemSymbol","asterisk"==c)$(f).html("*");else if("ellipse"==c){var g=this.getWidth(b),h=this.getHeight(b),i=this.getDefaultStyleAttribute(b,"fillColor"),j=this.getDefaultStyleAttribute(b,"strokeColor"),k="";k+='<?xml version="1.0" standalone="no"?>',k+='<!DOCTYPE svg PUBLIC "-//W3C//DTD SVG 1.1//EN" "http://www.w3.org/Graphics/SVG/1.1/DTD/svg11.dtd">',k+='<svg width="100%" height="100%" version="1.0" xmlns="http://www.w3.org/2000/svg">',k+='<ellipse cx="50%" cy="50%" rx="'+g+'" ry="'+h+'" fill="'+i+'" stroke-width="1" stroke="'+j+'"/>',k+="</svg> ",$(f).html(k)}else if("circle"==c){var l=this.getRadius(b),i=this.getDefaultStyleAttribute(b,"fillColor"),j=this.getDefaultStyleAttribute(b,"strokeColor"),k="";k+='<?xml version="1.0" standalone="no"?>',k+='<!DOCTYPE svg PUBLIC "-//W3C//DTD SVG 1.1//EN" "http://www.w3.org/Graphics/SVG/1.1/DTD/svg11.dtd">',k+='<svg width="100%" height="100%" version="1.0" xmlns="http://www.w3.org/2000/svg">',k+='<circle cx="50%" cy="50%" r="'+l+'" fill="'+i+'" stroke-width="1" stroke="'+j+'"/>',
k+="</svg> ",$(f).html(k)}else if("line"==c){var m=this.getLength(b),g=this.getWidth(b),j=void 0,n=this.getDefaultStyleAttribute(b,"strokeColor");j=void 0==e?n:this.getClassStyleAttribute(b,d,e,"strokeColor")||n;var k="";k+='<?xml version="1.0" standalone="no"?>',k+='<!DOCTYPE svg PUBLIC "-//W3C//DTD SVG 1.1//EN" "http://www.w3.org/Graphics/SVG/1.1/DTD/svg11.dtd">',k+='<svg width="'+m+'px" height="100%" style="margin-left:auto;margin-right:auto;" version="1.0" xmlns="http://www.w3.org/2000/svg">',k+='<line x1="0" y1="50%" x2="'+m+'" y2="50%" stroke-width="'+g+'" stroke="'+j+'"/>',k+="</svg> ",$(f).html(k)}else if("marker"==c){var o=this.getDefaultStyleAttribute(b,"externalGraphic"),p=void 0;p=void 0==e?o:this.getClassStyleAttribute(b,d,e,"externalGraphic")||o;var g=this.getWidth(b);if(void 0!=p){var q=document.createElement("img");void 0!=g?$(q).attr({width:g+"",border:"0",src:p,alt:p}):$(q).attr({border:"0",src:p,alt:p}),f.appendChild(q)}else $(f).html("<div><span>Marker Does not Exist</span></div>")}return f},getSymbolType:function(a){var b=!1;return void 0!=this.carto&&void 0!=this.carto.layers&&void 0!=this.carto.layers[""+a]&&void 0!=this.carto.layers[""+a].legend&&void 0!=this.carto.layers[""+a].legend.symbol&&(b=this.carto.layers[""+a].legend.symbol),b},getDefaultLabel:function(a){var b="No Label Specified";return void 0!=this.carto&&void 0!=this.carto.layers&&void 0!=this.carto.layers[""+a]&&void 0!=this.carto.layers[""+a].legend&&void 0!=this.carto.layers[""+a].legend.label&&(b=this.carto.layers[""+a].legend.label),b},getClassLabel:function(a,b,c){var d="No Label Specified";return void 0!=this.carto&&void 0!=this.carto.layers&&void 0!=this.carto.layers[""+a]&&void 0!=this.carto.layers[""+a].classifications&&void 0!=this.carto.layers[""+a].classifications[b]&&void 0!=this.carto.layers[""+a].classifications[b].data&&void 0!=this.carto.layers[""+a].classifications[b].data[c]&&void 0!=this.carto.layers[""+a].classifications[b].data[c].label&&(d=this.carto.layers[""+a].classifications[b].data[c].label),d},getEllipsis:function(a){},getDefaultStyleAttribute:function(a,b){var c=this.getDefaultSymbolizer(a,OpenLayers.Feature.Vector.style["default"]),d=void 0;return void 0!=c&&void 0!=c[b]&&(d=c[b]),d},getClassStyleAttribute:function(a,b,c,d){var e=void 0;return void 0!=this.carto&&void 0!=this.carto.layers&&void 0!=this.carto.layers[""+a]&&void 0!=this.carto.layers[""+a].classifications&&void 0!=this.carto.layers[""+a].classifications[b]&&void 0!=this.carto.layers[""+a].classifications[b].data&&void 0!=this.carto.layers[""+a].classifications[b].data[c]&&void 0!=this.carto.layers[""+a].classifications[b].data[c].style&&void 0!=this.carto.layers[""+a].classifications[b].data[c].style["default"]&&void 0!=this.carto.layers[""+a].classifications[b].data[c].style["default"][d]&&(e=this.carto.layers[""+a].classifications[b].data[c].style["default"][d]),e},getRadius:function(a){var b=void 0;return void 0!=this.carto&&void 0!=this.carto.layers&&void 0!=this.carto.layers[""+a]&&void 0!=this.carto.layers[""+a].legend&&void 0!=this.carto.layers[""+a].legend.radius&&(b=this.carto.layers[""+a].legend.radius),b},getLength:function(a){var b=void 0;return void 0!=this.carto&&void 0!=this.carto.layers&&void 0!=this.carto.layers[""+a]&&void 0!=this.carto.layers[""+a].legend&&void 0!=this.carto.layers[""+a].legend.length&&(b=this.carto.layers[""+a].legend.length),b},getWidth:function(a){var b=void 0;return void 0!=this.carto&&void 0!=this.carto.layers&&void 0!=this.carto.layers[""+a]&&void 0!=this.carto.layers[""+a].legend&&void 0!=this.carto.layers[""+a].legend.width&&(b=this.carto.layers[""+a].legend.width),b},getHeight:function(a){var b=!1;return void 0!=this.carto&&void 0!=this.carto.layers&&void 0!=this.carto.layers[""+a]&&void 0!=this.carto.layers[""+a].legend&&void 0!=this.carto.layers[""+a].legend.height&&(b=this.carto.layers[""+a].legend.height),b},hasLegendItem:function(a){var b=!1;return void 0!=this.carto&&void 0!=this.carto.layers&&void 0!=this.carto.layers[""+a]&&(b=void 0!=this.carto.layers[""+a].legend),b},hasClassification:function(a,b){var c=!1;return void 0!=this.carto&&void 0!=this.carto.layers&&void 0!=this.carto.layers[""+a]&&void 0!=this.carto.layers[""+a].classifications&&(c=$.grep(this.carto.layers[""+a].classifications,function(a,c){return a.type==b}).length>0),c},getDefaultLegendClassifier:function(a,b){var c=-1;if(void 0!=this.carto&&void 0!=this.carto.layers&&void 0!=this.carto.layers[""+a]&&void 0!=this.carto.layers[""+a].classifications)for(var d=0;d<this.carto.layers[""+a].classifications.length;d++)if(this.carto.layers[""+a].classifications[d].type==b){c=d;break}return c},getClassNames:function(a,b){var c=[];if(void 0!=this.carto.layers[""+a]&&void 0!=this.carto.layers[""+a].classifications){var d=this.carto.layers[""+a].classifications;if(void 0!=d[b]){var e=d[b].data;$.each(e,function(a,b){"default"!=a&&c.push(a)})}}return c},getDefaultSymbolizer:function(a,b){var c=void 0;if(void 0!=this.carto.layers[""+a]&&void 0!=this.carto.layers[""+a].style&&void 0!=this.carto.layers[""+a].style.intents["default"]&&void 0!=this.carto.layers[""+a].style.intents["default"]&&(c=this.carto.layers[""+a].style.intents["default"]),void 0!=c){var d={};if(void 0!=c.templates)if($.isArray(c.templates))for(var e=0;e<c.templates.length;e++){var f=c.templates[e],g=this.getStyleTemplate(f.ns,f.id);d=OpenLayers.Util.applyDefaults(OpenLayers.Util.extend({},d),g)}else if("string"==typeof c.templates)for(var h=c.templates.split(","),e=0;e<h.length;e++){var i=h[e].split(":"),j=$.trim(i[0]),k=$.trim(i[1]),g=this.getStyleTemplate(j,k);d=OpenLayers.Util.applyDefaults(OpenLayers.Util.extend({},d),g)}void 0!=c.properties&&(d=OpenLayers.Util.applyDefaults(OpenLayers.Util.extend({},d),c.properties)),void 0!=b&&(d=OpenLayers.Util.applyDefaults(OpenLayers.Util.extend({},d),b))}return d},getStyleTemplate:function(a,b){var c=void 0;return void 0!=this.carto&&void 0!=this.carto.library&&void 0!=this.carto.library.templates[""+a]&&void 0!=this.carto.library.templates[""+a][""+b]&&(c=this.carto.library.templates[""+a][""+b]),c},destroy:function(){this.sliderEvents.un({touchstart:this.zoomBarDown,touchmove:this.zoomBarDrag,touchend:this.zoomBarUp,mousedown:this.zoomBarDown,mousemove:this.zoomBarDrag,mouseup:this.zoomBarUp}),this.sliderEvents.destroy()},CLASS_NAME:"OpenLayers.Control.AdvancedLegend"}),$.widget("custom.autocompleteLayer",$.ui.autocomplete,{_renderMenu:function(a,b){var c=this,d=void 0;$.each(b,function(b,e){e.layer!=d&&(a.append("<li class='cybergis-search-layer'>"+e.layer+"</li>"),d=e.layer),c._renderItem(c.options.control,a,e)})},_renderItem:function(a,b,c){var d=$("<a></a>");if(a.bCarto){var e=c.proto,f=void 0;if(a.hasClassification(e,"basic")){var g=a.getDefaultLegendClassifier(e,"basic"),h=CyberGIS.getJSON(["layers",e,"classifications",""+g],a.carto),i=c.feature.attributes[""+h.field];f=a.createLegendItemSymbol.apply(a,[{sLayer:e,sType:a.getSymbolType(c.proto),iClassifier:g,sClass:i}])}else f=a.createLegendItemSymbol.apply(a,[{sLayer:e,sType:a.getSymbolType(e)}]);f&&d.append(f)}return d.append(c.label),$("<li></li>").data("item.autocomplete",c).addClass("cybergis-search-feature").append(d).appendTo(b)}}),$.extend($.ui.autocomplete,{filterLayer:function(a,b,c){var d=void 0,e=new RegExp($.ui.autocomplete.escapeRegex(b),"i");if(c>0){d=[];for(var f=0;f<a.length;f++){for(var g=!1,h=a[f].values,i=0;i<h.length;i++)if(e.test(h[i])){g=!0;break}if(g&&(d.push(a[f]),d.length==c))break}}else-1==c?d=$.grep(a,function(a){for(var b=!1,c=a.values,d=0;d<c.length;d++)if(e.test(c[d])){b=!0;break}return b}):0==c&&(d=[]);return d}}),OpenLayers.Control.AdvancedSearch=OpenLayers.Class(OpenLayers.Control,{daysoftheweek:["Sunday","Monday","Tuesday","Wednesday","Thursday","Friday","Saturday"],monthsoftheyear:["January","February","March","April","May","June","July","August","September","October","November","December"],type:"static",mainDiv:void 0,mode:"flexible",middle:void 0,mainLabel:void 0,searchInput:void 0,listener:void 0,updateDelay:2e3,expandedMaxWidth:380,collapsedMaxWidth:220,padding:20,layer:null,layers:null,bCarto:!1,bGroup:!0,bLimit:!1,iLimit:10,bFold:!0,bHide:!1,bFade:!0,bAppendLayer:!1,passthroughEvents:!1,blackholeEvents:!1,acLabel:void 0,acLabels:["label"],acFeatures:[],acSource:[],targetFeature:void 0,targetZoom:void 0,currentStatus:void 0,selectControl:void 0,isFlexible:function(){return"flexible"==this.mode},isFixed:function(){return"fixed"==this.mode},setSelectControl:function(a){this.selectControl=a},hasSelectControl:function(){return void 0!=this.selectControl},getSelectControl:function(){return this.selectControl},isAnimated:function(){return this.animate},getMaxWidth:function(){return OpenLayers.Element.hasClass(this.mainDiv,"collapsed")?this.collapsedMaxWidth:this.expandedMaxWidth},setLayer:function(a){var b=this;this.layer=a,a.events.register("loadend",a,function(){b.refresh.apply(b)}),a.events.register("featuresadded",a,function(){b.refresh.apply(b)}),a.events.on({featureunselected:function(a){b.onFeatureUnselected.apply(b,[a])}})},setLayers:function(a){var b=this;this.layers=a;for(var c=0;c<a.length;c++){var d=a[c];d.events.register("loadend",d,function(){b.refresh.apply(b)}),d.events.register("featuresadded",d,function(){b.refresh.apply(b)}),d.events.on({featureunselected:function(a){b.onFeatureUnselected.apply(b,[a])}})}},setMap:function(a){OpenLayers.Control.prototype.setMap.apply(this,[a]);var b=this;if(void 0!=this.layers)for(var c=0;c<this.layers.length;c++)a.events.register("zoomend",this.layers[c],function(){b.refresh.apply(b)});else a.events.register("zoomend",this.layer,function(){b.refresh.apply(b)})},createSearch:function(){this.createHeading(this.searchContainer),void 0!=this.layer?this.createSearchInput([this.layers],this.searchContainer):void 0!=this.layers&&this.createSearchInput(this.layers,this.searchContainer)},createHeading:function(a){var b=this.createSearchHeading();$(b).data("olControlAdvancedSearch",this),$(b).click(function(){var a=$(this).data("olControlAdvancedSearch");a.onSearchHeadingClick.apply(a)}),a.appendChild(b)},createSearchInput:function(a,b){var c=document.createElement("div");c.className="olControlAdvancedSearchItem olControlAdvancedSearchInputContainer";var d=document.createElement("div");d.className="olControlAdvancedSearchInput",this.searchInput=document.createElement("input"),this.searchInput.type="text",$(this.searchInput).attr({placeholder:"Search ..."}),this.initializeAutocompleteInput(this.searchInput,"single",!1,this.validateAutocomplete,function(){}),d.appendChild(this.searchInput),c.appendChild(d),b.appendChild(c)},refresh:function(){void 0!=this.layer?this.refreshLayer(this.layer,this.legendContainer):void 0!=this.layers&&this.refreshLayers(this.layers,this.legendContainer),this.refreshAutocomplete()},refreshLayers:function(a,b){this.acFeatures=[],this.acSource=[];for(var c=0;c<a.length;c++){var d=a[c];if(void 0!=d)for(var e=0;e<d.features.length;e++)for(var f=d.features[e],g=this.buildAutocompleteLabels(f,d),h=0;h<g.length;h++){var i=g[h];if(this.bGroup||this.bFold||this.bCarto){var j=d.name;this.acFeatures.push(f),this.acSource.push({values:[this.bFold?this.fold(i):i],label:i,proto:d.proto,layer:j,feature:f})}else this.acFeatures.push(f),this.acSource.push(i)}}},refreshLayer:function(a,b){if(this.acFeatures=[],this.acSource=[],void 0!=a)for(var c=0;c<a.features.length;c++)for(var d=a.features[c],e=this.buildAutocompleteLabels(d,a),f=0;f<e.length;f++){var g=e[f];this.acFeatures.push(d),this.acSource.push(g)}},refreshAutocomplete:function(){$(this.searchInput).data("acSource",this.acSource)},setLegendItems:function(a,b){void 0==this.legendItems&&(this.legendItems={}),this.legendItems[""+a]=b},isSingle:function(){return"single"==this.type},isRange:function(){return"range"==this.type},copyDate:function(a){return new Date(a.getFullYear(),a.getMonth(),a.getDate())},formatDate:function(a,b){return void 0==a?"":"label"==b?this.monthsoftheyear[a.getMonth()]+" "+a.getDate()+", "+a.getFullYear():"wfs"==b?a.getFullYear()+"-"+(a.getMonth()<9?"0"+(a.getMonth()+1):a.getMonth()+1)+"-"+(a.getDate()<10?"0"+a.getDate():a.getDate()):void 0},boundDate:function(a){var b=void 0;return b=a.getTime()>this.getMaxTime()?this.copyDate(this.getMaxDate()):a.getTime()<this.getMinTime()?this.copyDate(this.getMinDate()):this.copyDate(a)},getUpdateDelay:function(){return this.updateDelay()},setUpdateDelay:function(a){this.updateDelay=a},collapse:function(){if(this.collapseTimer=void 0,OpenLayers.Element.hasClass(this.mainDiv,"collapsed")||OpenLayers.Element.addClass(this.mainDiv,"collapsed"),$(this.mainDiv).stop(!0,!1),this.isAnimated()){var a=this.map,b=Math.min(a.getCurrentSize().w-this.padding,this.getMaxWidth()),c=-1*(b/2)-this.padding/4;$(this.mainDiv).animate({width:b,"margin-left":c})}else this._resizeSearch();$(this.searchInput).val(""),this.clearTarget(),$(this.searchInput).blur(),$(this.map).focus()},expand:function(){if(OpenLayers.Element.hasClass(this.mainDiv,"collapsed")&&OpenLayers.Element.removeClass(this.mainDiv,"collapsed"),$(this.mainDiv).stop(!0,!1),$(this.searchInput).val(""),this.clearTarget(),$(this.map).blur(),$(this.searchInput).focus(),this.isAnimated()){var a=this.map,b=Math.min(a.getCurrentSize().w-this.padding,this.getMaxWidth()),c=-1*(b/2)-this.padding/4;$(this.mainDiv).animate({width:b,"margin-left":c})}else this._resizeSearch()},initialize:function(a,b){OpenLayers.Control.prototype.initialize.apply(this,[b]),OpenLayers.Util.isArray(a)?this.setLayers(a):this.setLayer(a),CyberGIS.isString(this.acLabel)&&(this.acLabels=[this.acLabel]),void 0!=b&&void 0!=b.selectControl&&this.setSelectControl(b.selectControl)},draw:function(){var a=OpenLayers.Control.prototype.draw.apply(this);this.isFlexible()?OpenLayers.Element.addClass(a,"flexible"):this.isFixed()&&OpenLayers.Element.addClass(a,"fixed"),this.isSingle()?OpenLayers.Element.addClass(a,"single"):this.isRange()&&OpenLayers.Element.addClass(a,"range");var b=document.createElement("div");b.className="olControlAdvancedSearchMiddle olControlMiddle";var c=document.createElement("div");c.className="olControlAdvancedSearchLabel",$(c).data("olControlAdvancedSearch",this);var d=document.createElement("span");d.innerHTML="Search",c.appendChild(d),b.appendChild(c),this.searchContainer=document.createElement("div"),this.searchContainer.className="olControlAdvancedSearchContainer",this.createSearch(),b.appendChild(this.searchContainer),a.appendChild(b),this.mainDiv=a,$(c).click(function(){var a=$(this).data("olControlAdvancedSearch");a.onMainLabelClick.apply(a)});var e=this.map.events;return e.registerPriority("click",this,this.onMapClick),$(a).on("click dblclick",null,this,this.onSearchClick),$(a).on("click dblclick","input",this,this.onSearchInputClick),a},onSearchClick:function(a){var b=a.data;b.blackholeEvents?b.blackhole(a):b.passthroughEvents?b.passthrough(a):b.map.events.bypassOnce=!0},onSearchInputClick:function(a){var b=this,c=a.data.map;c.events.bypassOnce=!0,setTimeout(function(){$(c.div).blur(),$(b).focus()},0)},passthrough:function(a){return!1},blackhole:function(a){a.stopPropagation()},onSearchHeadingClick:function(){this.isFlexible()&&this.collapse()},onMainLabelClick:function(){this.expand()},onMapClick:function(){this.isFlexible()&&this.collapse()},onMapResize:function(){this._resizeSearch()},_resizeSearch:function(){},createLegendItems:function(a,b){var c=[];if(this.hasClassification(a,"basic")){var d=this.getDefaultLegendClassifier(a,"basic"),e=this.getClassNames(a,d);if(0==e.length);else if(1==e.length)c.push(this.createLegendItem({sLayer:a,iClassifier:d,sClass:e[0],inRange:b}));else{c.push(this.createLegendBreak()),c.push(this.createLegendSubHeading(a));for(var f=0;f<e.length;f++)c.push(this.createLegendItem({sLayer:a,iClassifier:d,sClass:e[f],inRange:b}))}}else c.push(this.createLegendItem({sLayer:a,inRange:b}));return c},createLegendItem:function(a){var b=a.sLayer,c=a.iClassifier,d=a.sClass,e=a.inRange,f=document.createElement("div");if(e?f.className="olControlAdvancedLegendItem":this.bHide?f.className="olControlAdvancedLegendItem hidden":this.bFade?f.className="olControlAdvancedLegendItem fade":f.className="olControlAdvancedLegendItem",void 0==d){var g=this.getSymbolType(b);void 0!=g&&f.appendChild(this.createLegendItemSymbol({sLayer:b,sType:g}));var h=this.createLegendItemLabel({sLayer:b});f.appendChild(h)}else{var g=this.getSymbolType(b);void 0!=g&&f.appendChild(this.createLegendItemSymbol({sLayer:b,iClassifier:c,sClass:d,sType:g}));var h=this.createLegendItemLabel({sLayer:b,iClassifier:c,sClass:d});f.appendChild(h)}return f},createSearchHeading:function(){var a=document.createElement("div");a.className="olControlAdvancedSearchItem olControlAdvancedSearchHeadingContainer",$(a).css("height","auto");var b=document.createElement("div");return b.className="olControlAdvancedSearchHeading",$(b).html("<div><span>Search</span></div>"),a.appendChild(b),a},createLegendItemLabel:function(a){var b=a.sLayer,c=a.iClassifier,d=a.sClass,e=document.createElement("div");return e.className="olControlAdvancedLegendItemLabel",void 0==d?$(e).html("<div><span>"+this.getDefaultLabel(b)+"</span></div>"):$(e).html("<div><span>"+this.getClassLabel(b,c,d)+"</span></div>"),e},createLegendItemSymbol:function(a){var b=a.sLayer,c=a.sType,d=a.iClassifier,e=a.sClass,f=document.createElement("div");if(f.className="olControlAdvancedLegendItemSymbol","ellipse"==c){var g=this.getWidth(b),h=this.getHeight(b),i=this.getDefaultStyleAttribute(b,"fillColor"),j=this.getDefaultStyleAttribute(b,"strokeColor"),k="";k+='<?xml version="1.0" standalone="no"?>',k+='<!DOCTYPE svg PUBLIC "-//W3C//DTD SVG 1.1//EN" "http://www.w3.org/Graphics/SVG/1.1/DTD/svg11.dtd">',k+='<svg width="100%" height="100%" version="1.0" xmlns="http://www.w3.org/2000/svg">',k+='<ellipse cx="50%" cy="50%" rx="'+g+'" ry="'+h+'" fill="'+i+'" stroke-width="1" stroke="'+j+'"/>',k+="</svg> ",$(f).html(k)}else if("circle"==c){var l=this.getRadius(b),i=this.getDefaultStyleAttribute(b,"fillColor"),j=this.getDefaultStyleAttribute(b,"strokeColor"),k="";k+='<?xml version="1.0" standalone="no"?>',k+='<!DOCTYPE svg PUBLIC "-//W3C//DTD SVG 1.1//EN" "http://www.w3.org/Graphics/SVG/1.1/DTD/svg11.dtd">',k+='<svg width="100%" height="100%" version="1.0" xmlns="http://www.w3.org/2000/svg">',k+='<circle cx="50%" cy="50%" r="'+l+'" fill="'+i+'" stroke-width="1" stroke="'+j+'"/>',k+="</svg> ",$(f).html(k)}else if("marker"==c){var m=this.getDefaultStyleAttribute(b,"externalGraphic"),n=void 0;if(void 0==e)n=m;else{var o=this.getClassStyleAttribute(b,d,e,"externalGraphic");n=void 0!=o?o:m}var g=this.getWidth(b);if(void 0!=n){var p=document.createElement("img");void 0!=g?$(p).attr({width:g+"",border:"0",src:n,alt:n}):$(p).attr({border:"0",src:n,alt:n}),f.appendChild(p)}else $(f).html("<div><span>Marker Does not Exist</span></div>")}return f},getSymbolType:function(a){var b=!1;return void 0!=this.carto&&void 0!=this.carto.layers&&void 0!=this.carto.layers[""+a]&&void 0!=this.carto.layers[""+a].legend&&void 0!=this.carto.layers[""+a].legend.symbol&&(b=this.carto.layers[""+a].legend.symbol),b},getDefaultLabel:function(a){var b="No Label Specified";return void 0!=this.carto&&void 0!=this.carto.layers&&void 0!=this.carto.layers[""+a]&&void 0!=this.carto.layers[""+a].legend&&void 0!=this.carto.layers[""+a].legend.label&&(b=this.carto.layers[""+a].legend.label),b},getClassLabel:function(a,b,c){var d="No Label Specified";return void 0!=this.carto&&void 0!=this.carto.layers&&void 0!=this.carto.layers[""+a]&&void 0!=this.carto.layers[""+a].classifications&&void 0!=this.carto.layers[""+a].classifications[b]&&void 0!=this.carto.layers[""+a].classifications[b].data&&void 0!=this.carto.layers[""+a].classifications[b].data[c]&&void 0!=this.carto.layers[""+a].classifications[b].data[c].label&&(d=this.carto.layers[""+a].classifications[b].data[c].label),d},getEllipsis:function(a){},getDefaultStyleAttribute:function(a,b){var c=this.getDefaultSymbolizer(a,OpenLayers.Feature.Vector.style["default"]),d=void 0;return void 0!=c&&void 0!=c[b]&&(d=c[b]),d},getClassStyleAttribute:function(a,b,c,d){var e=void 0;return void 0!=this.carto&&void 0!=this.carto.layers&&void 0!=this.carto.layers[""+a]&&void 0!=this.carto.layers[""+a].classifications&&void 0!=this.carto.layers[""+a].classifications[b]&&void 0!=this.carto.layers[""+a].classifications[b].data&&void 0!=this.carto.layers[""+a].classifications[b].data[c]&&void 0!=this.carto.layers[""+a].classifications[b].data[c].style&&void 0!=this.carto.layers[""+a].classifications[b].data[c].style["default"]&&void 0!=this.carto.layers[""+a].classifications[b].data[c].style["default"][d]&&(e=this.carto.layers[""+a].classifications[b].data[c].style["default"][d]),e},getRadius:function(a){var b=void 0;return void 0!=this.carto&&void 0!=this.carto.layers&&void 0!=this.carto.layers[""+a]&&void 0!=this.carto.layers[""+a].legend&&void 0!=this.carto.layers[""+a].legend.radius&&(b=this.carto.layers[""+a].legend.radius),b},getWidth:function(a){var b=void 0;return void 0!=this.carto&&void 0!=this.carto.layers&&void 0!=this.carto.layers[""+a]&&void 0!=this.carto.layers[""+a].legend&&void 0!=this.carto.layers[""+a].legend.width&&(b=this.carto.layers[""+a].legend.width),b},getHeight:function(a){var b=!1;return void 0!=this.carto&&void 0!=this.carto.layers&&void 0!=this.carto.layers[""+a]&&void 0!=this.carto.layers[""+a].legend&&void 0!=this.carto.layers[""+a].legend.height&&(b=this.carto.layers[""+a].legend.height),b},hasLegendItem:function(a){var b=!1;return void 0!=this.carto&&void 0!=this.carto.layers&&void 0!=this.carto.layers[""+a]&&(b=void 0!=this.carto.layers[""+a].legend),b},hasClassification:function(a,b){var c=!1;return void 0!=this.carto&&void 0!=this.carto.layers&&void 0!=this.carto.layers[""+a]&&void 0!=this.carto.layers[""+a].classifications&&(c=$.grep(this.carto.layers[""+a].classifications,function(a,c){return a.type==b}).length>0),c},getDefaultLegendClassifier:function(a,b){var c=-1;if(void 0!=this.carto&&void 0!=this.carto.layers&&void 0!=this.carto.layers[""+a]&&void 0!=this.carto.layers[""+a].classifications)for(var d=0;d<this.carto.layers[""+a].classifications.length;d++)if(this.carto.layers[""+a].classifications[d].type==b){c=d;break}return c},getClassNames:function(a,b){var c=[];if(void 0!=this.carto.layers[""+a]&&void 0!=this.carto.layers[""+a].classifications){var d=this.carto.layers[""+a].classifications;if(void 0!=d[b]){var e=d[b].data;$.each(e,function(a,b){"default"!=a&&c.push(a)})}}return c},onFeatureUnselected:function(a){this.clearAutocompleteTarget()},buildTargetZoom:function(a,b){var c=void 0,d=a.layer,e=b.getZoom();if(d.inRange)c=e;else{var f=$.inArray(d.minResolution,b.resolutions),g=$.inArray(d.maxResolution,b.resolutions);e>f?c=f:g>e&&(c=g)}return c},clearAutocompleteTarget:function(){this.targetFeature=void 0,$(this.searchInput).val(""),this.validateAutocomplete.apply(this,[this.searchInput])},initializeAutocompleteInput:function(a,b,c,d){var e=$(a);if("multiple"==b.toLowerCase());else if("single"==b.toLowerCase()){e.data("context",this),e.change(function(a){var b=$(this).data("context");b.validateAutocomplete.apply(b,[this])});var f={minLength:0};this.bGroup||this.bFold||this.bLimit?(f.source=function(a,b){var c=this.options.control,d=$(this.element).data("acSource");b(void 0!=d?$.ui.autocomplete.filterLayer(d,c.bFold?c.fold(a.term):a.term,c.bLimit?c.iLimit:-1):[])},f.select=function(a,b){this.value=b.item.value;var c=$(this).data("context"),d=c.setFeatureTarget.apply(c,[b.item.feature]);return c.setStatus.apply(c,[d]),!1},f.control=this,e.autocompleteLayer(f)):(f.source=function(a,b){var c=$(this.element).data("acSource");b(void 0!=c?$.ui.autocomplete.filter(c,a.term):[])},f.select=function(a,b){this.value=b.item.value;var c=$(this).data("context");return c.validateAutocomplete.apply(c,[this]),!1},e.autocomplete(f))}},buildAutocompleteLabels:function(a,b){for(var c=[],d=0;d<this.acLabels.length;d++){var e=this.acLabels[d],f=a.attributes[""+e];if(CyberGIS.isString(f)){var g=f;this.bAppendLayer&&(g+=" ("+b.name+")"),c.push(g)}}return c},validateAutocomplete:function(a){var b=$(a),c=0,d=1==$(this).data("ac-multiple")?"multiple":"single",e=$.trim(b.val());if(""==e)b.removeData("ac-id"),c=0;else if(e.match(new RegExp("^(\\s*)([-+]?\\d*[.]?\\d*)(\\s*)[,](\\s*)([-+]?\\d*[.]?\\d*)(\\s*)$"))){b.removeData("ac-id"),c=0;var f=e.split(","),g=f[1].trim(),h=f[0].trim(),i=parseFloat(g),j=parseFloat(h),k=this.getSelectControl(),l=new OpenLayers.Projection("EPSG:4326"),m=new OpenLayers.LonLat(i,j),n=m.transform(l,this.map.getProjectionObject());n.equals(this.targetLocation)||(this.targetLocation=n,this.targetZoom=null,this.targetFeature=null,k.focusOnItem.apply(k,[void 0,n]))}else if(e.match(new RegExp("^([-+]?\\d*[.]?\\d*)(\\s*)[,](\\s*)([-+]?\\d*[.]?\\d*)(\\s*)[,](\\s*)(\\d{1,2})(\\s*)$"))){b.removeData("ac-id"),c=0;var f=e.split(","),g=f[1].trim(),h=f[0].trim(),o=f[2].trim(),i=parseFloat(g),j=parseFloat(h),p=parseInt(o,10),k=this.getSelectControl(),l=new OpenLayers.Projection("EPSG:4326"),m=new OpenLayers.LonLat(i,j),n=m.transform(l,this.map.getProjectionObject());k.focusOnItem.apply(k,[void 0,n,p]),n.equals(this.targetLocation)||this.targetZoom==p||(this.targetLocation=n,this.targetZoom=p,this.targetFeature=null,k.focusOnItem.apply(k,[void 0,n,p]))}else if(e.match(new RegExp("^(\\s*)zoom(\\s*):(\\s*)(\\d{1,2})(\\s*)$","i"))||e.match(new RegExp("^(\\s*)z(\\s*):(\\s*)(\\d{1,2})(\\s*)$","i"))){b.removeData("ac-id"),c=0;var q=e.split(":"),r=parseInt(q[1],10),s=this.map.center,k=this.getSelectControl();k.focusOnItem.apply(k,[void 0,s,r])}else if("single"==d){var t=this.inSource(e,b.data("acSource"));-1!=t?c=this.setFeatureTarget(this.acFeatures[t]):(b.removeData("ac-id"),c=-1)}this.setStatus(c)},setFeatureTarget:function(a){if(this.targetFeature!=a&&(this.targetLocation=null,this.targetZoom=null,this.targetFeature=a,this.targetZoom=this.buildTargetZoom(a,this.map),this.hasSelectControl())){var b=a.geometry,c=this.getSelectControl();c.unFocusAll.apply(c,[!0]),c.select.apply(c,[a]),c.focusOnItem.apply(c,[a,b,this.targetZoom])}return 1},fold:function(a){return void 0!=CyberGIS.Diacritics&&void 0!=CyberGIS.Diacritics.removeDiacritics?CyberGIS.Diacritics.removeDiacritics(a):a},setStatus:function(a){this.currentStatus!=a&&(1==a?($(this.searchInput).addClass("valid"),$(this.searchInput).removeClass("invalid")):-1==a?($(this.searchInput).removeClass("valid"),$(this.searchInput).addClass("invalid")):($(this.searchInput).removeClass("valid"),$(this.searchInput).removeClass("invalid")))},inSource:function(a,b){var c=-1;if(CyberGIS.isArray(b))if(this.bGroup)for(var d=0;d<b.length;d++){for(var e=b[d].values,f=0;f<e.length;f++)if(a.toLowerCase()==e[f].toLowerCase()){c=d;break}if(-1!=c)break}else c=$.inArray(a,b);return c},clearTarget:function(){this.targetLocation=null,this.targetZoom=null,this.targetFeature=null},getDefaultSymbolizer:function(a,b){var c=void 0;if(void 0!=this.carto.layers[""+a]&&void 0!=this.carto.layers[""+a].style&&void 0!=this.carto.layers[""+a].style.intents["default"]&&void 0!=this.carto.layers[""+a].style.intents["default"]&&(c=this.carto.layers[""+a].style.intents["default"]),void 0!=c){var d={};if(void 0!=c.templates)if($.isArray(c.templates))for(var e=0;e<c.templates.length;e++){var f=c.templates[e],g=this.getStyleTemplate(f.ns,f.id);d=OpenLayers.Util.applyDefaults(OpenLayers.Util.extend({},d),g)}else if("string"==typeof c.templates)for(var h=c.templates.split(","),e=0;e<h.length;e++){var i=h[e].split(":"),j=$.trim(i[0]),k=$.trim(i[1]),g=this.getStyleTemplate(j,k);d=OpenLayers.Util.applyDefaults(OpenLayers.Util.extend({},d),g)}void 0!=c.properties&&(d=OpenLayers.Util.applyDefaults(OpenLayers.Util.extend({},d),c.properties)),void 0!=b&&(d=OpenLayers.Util.applyDefaults(OpenLayers.Util.extend({},d),b))}return d},getStyleTemplate:function(a,b){var c=void 0;return void 0!=this.carto&&void 0!=this.carto.library&&void 0!=this.carto.library.templates[""+a]&&void 0!=this.carto.library.templates[""+a][""+b]&&(c=this.carto.library.templates[""+a][""+b]),c},destroy:function(){this.sliderEvents.un({touchstart:this.zoomBarDown,touchmove:this.zoomBarDrag,touchend:this.zoomBarUp,mousedown:this.zoomBarDown,mousemove:this.zoomBarDrag,mouseup:this.zoomBarUp}),this.sliderEvents.destroy()},CLASS_NAME:"OpenLayers.Control.AdvancedSearch"}),OpenLayers.Control.AdvancedSelectFeature=OpenLayers.Class(OpenLayers.Control.SelectFeature,{stopDown:!0,animate:!0,over:void 0,out:void 0,wheelStyleMaps:void 0,wheelOpenListeners:void 0,wheelCloseListeners:void 0,defaultAnchorPosition:"bottom-left",hoverDelay:100,hoverTimer:void 0,jitQueue:void 0,popupTimers:void 0,snapshotTimers:void 0,chartTimers:void 0,currentPopup:void 0,targetFeature:void 0,targetLocation:void 0,zoomEndTargetLevel:void 0,lock:!1,wheel:void 0,wheelTimer:void 0,wheelDelay:4e3,jit_listeners:[],bFocusFeature:!0,bFocusLocation:!0,popupFunction:void 0,popupContext:void 0,isAnimated:function(){return this.animate},setLock:function(){this.lock=!0},clearLock:function(){this.lock=!1},isLocked:function(){return this.lock},getLayerIndex:function(a){return $.inArray(a,this.layers)},hasWheelOpenListener:function(a){if(void 0!=this.wheelOpenListeners){var b=this.getLayerIndex(a);return-1!=b?void 0!=this.wheelOpenListeners[b]:!1}return!1},triggerWheelOpenListener:function(a){this.hasWheelOpenListener(a)&&this.wheelOpenListeners[this.getLayerIndex(a)]()},hasWheelCloseListener:function(a){if(void 0!=this.wheelCloseListeners){var b=this.getLayerIndex(a);return-1!=b?void 0!=this.wheelCloseListeners[b]:!1}return!1},triggerWheelCloseListener:function(a){this.hasWheelCloseListener(a)&&this.wheelCloseListeners[this.getLayerIndex(a)]()},hasOverFunction:function(a){if(void 0!=this.over){var b=this.getLayerIndex(a);return-1!=b?void 0!=this.over[b]:!1}return!1},getOverFunction:function(a){return this.over[this.getLayerIndex(a)]},execOverFunction:function(a){this.getOverFunction(a.layer)(a)},hasOutFunction:function(a){if(void 0!=this.out){var b=this.getLayerIndex(a);return-1!=b?void 0!=this.out[b]:!1}return!1},getOutFunction:function(a){return this.out[this.getLayerIndex(a)]},execOutFunction:function(a){this.getOutFunction(a.layer)(a)},overFeature:function(a){this.stopHoverTimer(),(void 0==a.attributes.hover||"off"==a.attributes.hover)&&(this.hasOverFunction(a.layer)&&this.execOverFunction(a),a.attributes.hover="on",a.layer.redraw())},outFeature:function(a){"on"==a.attributes.hover&&(this.hasOutFunction(a.layer)&&this.execOutFunction(a),a.attributes.hover="off",a.layer.redraw())},stopHoverTimer:function(){void 0!=this.hoverTimer&&(clearTimeout(this.hoverTimr),this.hoverTimer=void 0)},delayHoverTimer:function(a){var b=this;b.stopHoverTimer(),b.hoverTimer=setTimeout(function(){b.onHover()},b.hoverDelay)},onHover:function(a){a.layer.redraw()},onZoomEnd:function(){for(var a=this.layers||[this.layer],b=0;b<a.length;b++){var c=a[b];c.inRange||this.unFocusLayer(c,!0)}if(this.isWheelOpen()){var d=this.getWheel();d.target.layer.inRange||this.finishWheelTimer()}},hasPopup:function(a){return a.options.popup&&void 0!=this.popupFunction&&void 0!=this.popupContext},getPopupFunction:function(a){return this.popupFunction},getPopupContext:function(a){return this.popupContext},execPopupFunction:function(a,b,c,d,e,f){if(this.closeCurrentPopup(),this.hasPopup(b)){var g=this.getPopupFunction(b),h=this.getPopupContext(b),i=g.apply(h,[a,b,c,d,e,f]);this.setCurrentPopup(i)}},wrapPopupFunction:function(a,b,c,d,e,f){var g=this,h=function(){g.execPopupFunction.apply(g,[a,b,c,d,e,f])};return h},queuePopupFunction:function(a,b){var c=this,d=function(){setTimeout(function(){c.unselect(a)},0)};this.queuePopupFunction_Core(a,a.layer,a.attributes,b,"bottom-left",d)},queuePopupFunction_Core:function(a,b,c,d,e,f){var g=this.wrapPopupFunction(a,b,c,d,e,f);void 0==this.popupTimers&&(this.popupTimers=[]),this.popupTimers.push(setTimeout(g,0))},getCurrentPopup:function(){return this.currentPopup;
},setCurrentPopup:function(a){this.currentPopup=a},hasCurrentPopup:function(){return void 0!=this.currentPopup},closeCurrentPopup:function(){if(this.hasCurrentPopup()){var a=this.getCurrentPopup();a.hide(),a.purgeListeners(),a.close(),this.currentPopup=void 0}},clearJITQueue:function(){this.jitQueue=[]},queueJIT:function(a,b,c,d,e){this.jitQueue.push({f:a,layer:b,a:c,g:d,anchorPosition:e})},isJITLayer:function(a){var b=!1;return void 0!=a.options.jit&&(b=!0),b},jit_request_backup:function(a,b){var c=a.layer.options.jit,d=this;if(console.log("OpenLayers.Layer.AdvancedVector.jit_request()"),this.isJITLayer(a.layer)){var e=void 0,f=void 0;if(void 0!=c.join&&void 0!=c.join.left&&(e=a.attributes[""+c.join.left]),void 0!=c.file&&void 0!=c.file.url&&(f=c.file.url),void 0!=e&&void 0!=f){var g=this,h=a.layer;b&&this.jit_listeners.push({id:e,url:f,layer:h,context:d,listener:this.jit_response}),$.ajax({url:f,type:"GET",contentType:'application/json; charset="utf-8"',beforeSend:hiu.beforeSend,complete:function(b,c){console.log("jit complete status: "+c);var d=h.options.jit;if(void 0!=d){var e=void 0,f=void 0,i=void 0,j=void 0,k=void 0,l=void 0;if(void 0!=d.join&&(e=d.join.left,f=d.join.right,i=d.join.type,j=d.join.level),void 0!=h.options.jit&&void 0!=h.options.jit.file&&(k=h.options.jit.file.delimiter,l=h.options.jit.file.url),void 0!=e&&void 0!=k){var m=b.responseText.split("\n");if(m=$.grep(m,function(a,b){return $.trim(a).length>0}),m.length>1)for(var n=0;n<h.features.length;n++){var o=h.features[n];h.strategies[0].jit_feature(o,m,f,o.attributes[""+e],k,i,j)}g.jit_trigger_listeners.apply(g,[l,a.attributes[""+e]]),h.redraw()}}}})}}},jit_request:function(a,b){console.log("OpenLayers.Layer.AdvancedVector.jit_request()");var c=a.layer;if(this.isJITLayer(c))for(var d=c.strategies[0],e=this,f=0;f<d.getNumberOfJobs();f++){var g=d.getJob(f),h=!1;void 0!=g.refresh&&void 0!=g.refresh.focus&&(h=1==g.refresh.focus);var i=!d.isFeatureCompiled.apply(d,[a,g.id]);if(i||h)if("simple"==g.type)c.strategies[0].runTasks(g);else if("advanced"==g.type){var j=void 0,k=void 0;if(void 0!=g.join&&void 0!=g.join.left&&(j=a.attributes[""+g.join.left]),void 0!=g.file&&void 0!=g.file.url&&(k=g.file.url),void 0!=j&&void 0!=k){var l=this;b&&this.jit_listeners.push({id:j,url:k,layer:c,context:e,listener:this.jit_response}),$.ajax({url:k,type:"GET",contentType:'application/json; charset="utf-8"',beforeSend:hiu.beforeSend,complete:function(b,d){console.log("jit complete status: "+d);var e=c.options.jit;if(void 0!=e){var f=void 0,g=void 0;void 0!=e.join&&(f=e.join.left),void 0!=c.options.jit&&void 0!=c.options.jit.file&&(g=c.options.jit.file.url),c.strategies[0].jit_response(b.responseText),l.jit_trigger_listeners.apply(l,[g,a.attributes[""+f]])}}})}}}},jit_trigger_listeners:function(a,b){for(var c=[],d=0;d<this.jit_listeners.length;d++){var e=this.jit_listeners[d];(e.id=b&&e.url==a)?e.listener.apply(e.context,[e.layer]):c.push(e)}this.jit_listeners=c},jit_response_old_but_better:function(a){for(var b=[],c=0;c<this.jitQueue.length;c++){var d=this.jitQueue[c];if(a==d.layer){var e=this,f=function(){setTimeout(function(){e.unselect(d.f)},0)};this.queuePopupFunction_Core(d.f,d.layer,d.a,d.g,"bottom-left",f)}else b.push(d)}this.jitQueue=b},jit_response:function(a){for(var b=[],c=0;c<this.jitQueue.length;c++){var d=this.jitQueue[c];if(a==d.layer){var e=this,f=function(){setTimeout(function(){e.unselect(d.f)},0)};this.queuePopupFunction_Core(d.f,d.layer,d.a,d.g,d.anchorPosition,f)}else b.push(d)}this.jitQueue=b},hasStyleMap:function(a){if(void 0!=this.wheelStyleMaps){var b=this.getLayerIndex(a);return-1!=b?void 0!=this.wheelStyleMaps[b]:!1}return!1},getWheelPointStyleMap:function(a){var b=new OpenLayers.StyleMap({"default":OpenLayers.Feature.Vector.style["default"],select:OpenLayers.Feature.Vector.style.select});if(void 0!=this.wheelStyleMaps){var c=this.getLayerIndex(a);if(-1!=c&&c<this.wheelStyleMaps.length){var d=this.wheelStyleMaps[c];if(void 0!=d){var e=d.points;void 0!=e&&(b=e)}}}return b},getWheelLineStyleMap:function(a){var b=new OpenLayers.StyleMap({"default":OpenLayers.Feature.Vector.style["default"],select:OpenLayers.Feature.Vector.style.select});if(void 0!=this.wheelStyleMaps){var c=this.getLayerIndex(a);if(-1!=c&&c<this.wheelStyleMaps.length){var d=this.wheelStyleMaps[c];if(void 0!=d){var e=d.lines;void 0!=e&&(b=e)}}}return b},getWheelCloseStyleMap:function(a){var b=new OpenLayers.StyleMap({"default":OpenLayers.Feature.Vector.style["default"],select:OpenLayers.Feature.Vector.style.select});if(void 0!=this.wheelStyleMaps){var c=this.getLayerIndex(a);if(-1!=c&&c<this.wheelStyleMaps.length){var d=this.wheelStyleMaps[c];if(void 0!=d){var e=d.close;void 0!=e&&(b=e)}}}return b},clearPopupTimers:function(){void 0!=this.popupTimers&&(this.clearTimers(this.popupTimers),this.popupTimers=void 0)},clearSnapshotTimers:function(){void 0!=this.snapshotTimers&&(this.clearTimers(this.snapshotTimers),this.snapshotTimers=void 0)},clearChartTimers:function(){void 0!=this.chartTimers&&(this.clearTimers(this.chartTimers),this.chartTimers=void 0)},clearTimers:function(a){for(var b=0;b<a.length;b++)void 0!=a[b]&&(clearTimeout(a[b]),a[b]=void 0)},panComplete:function(a){console.log("panComplete()");var b=this.zoomEndTargetLevel;if(void 0!=b&&b!=this.map.getZoom()&&this.map.isValidZoomLevel(b)&&(this.zoomEndTargetLevel=void 0,this.zoomTo(b,!0),this.map.events.triggerEvent("zoomend")),void 0!=this.targetFeature){this.moveEndListener=null;var c=this.targetFeature,d=this.targetLocation;this.isJITLayer(c.layer)?this.isCompiled(c)?this.queuePopupFunction(c,d):this.queueJIT(c,c.layer,c.attributes,d,"bottom-left"):this.queuePopupFunction(c,d)}},zoomComplete:function(a){},zoomTo:function(a,b){this.map.moveTo(null,a,{dragging:void 0,forceZoomChange:void 0,silent:b})},focusOnItem:function(a,b,c,d){if(void 0!=a){var e=a.attributes;void 0==b&&(b=a.geometry);var f=void 0;f="OpenLayers.LonLat"==b.CLASS_NAME?b:b.getBounds().getCenterLonLat(),this.focusOnFeature(a,e,f,b,c)}else this.clearLock(),this.moveEndListener=null,"OpenLayers.LonLat"==b.CLASS_NAME?this.focusOnLocation(b,c,d):this.focusOnLocation(b.getBounds().getCenterLonLat(),c,d)},focusOnFeature:function(a,b,c,d,e){var f=b.btn;this.isJITLayer(a.layer)&&(this.clearJITQueue(),this.jit_request(a,!0)),void 0!=f&&OpenLayers.Element.addClass(f,"x-btn-pressed"),this.clearLock(),this.atCenter(c)?(void 0!=e&&e!=this.map.getZoom()&&this.map.isValidZoomLevel(e)&&(this.zoomTo(e,!0),this.map.events.triggerEvent("zoomend")),this.hasPopup(a.layer)&&(this.isJITLayer(a.layer)?this.isCompiled(a)?this.queuePopupFunction(a,d):this.queueJIT(a,a.layer,a.attributes,d,"bottom-left"):this.queuePopupFunction(a,d))):this.closeToCenter(c)?(void 0!=e&&e!=this.map.getZoom()&&this.map.isValidZoomLevel(e)&&this.map.moveTo(c,e,{dragging:void 0,forceZoomChange:void 0,silent:!0}),this.hasPopup(a.layer)&&(this.isJITLayer(a.layer)?this.isCompiled(a)?this.queuePopupFunction(a,d):this.queueJIT(a,a.layer,a.attributes,d,"bottom-left"):this.queuePopupFunction(a,d))):(this.moveEndListener=null,this.animate?(this.targetFeature=a,this.targetLocation=d,void 0!=e&&e!=this.map.getZoom()&&this.map.isValidZoomLevel(e)&&(e>this.map.getZoom()?this.zoomEndTargetLevel=e:e<this.map.getZoom()&&(this.zoomTo(e,!0),this.map.events.triggerEvent("zoomend"))),this.map.panTo(c,this)):(this.targetFeature=a,this.targetLocation=d,void 0!=e&&e!=this.map.getZoom()&&this.map.isValidZoomLevel(e)?this.map.moveTo(c,e,{dragging:void 0,forceZoomChange:void 0,silent:!1}):this.map.setCenter(c,this)))},focusOnLocation:function(a,b,c){this.clearLock(),this.atCenter(a)?void 0!=b&&b!=this.map.getZoom()&&this.map.isValidZoomLevel(b)&&(this.zoomTo(b,!0),this.map.events.triggerEvent("zoomend")):this.closeToCenter(a)?void 0!=b&&b!=this.map.getZoom()&&this.map.isValidZoomLevel(b)&&this.map.moveTo(a,b,{dragging:void 0,forceZoomChange:void 0,silent:!0}):this.animate?void 0!=b&&b!=this.map.getZoom()&&this.map.isValidZoomLevel(b)?(b>this.map.getZoom()?this.zoomEndTargetLevel=b:b<this.map.getZoom()&&(this.zoomTo(b,!0),this.map.events.triggerEvent("zoomend")),this.map.panTo(a,this)):this.map.panTo(a,this):void 0!=b&&b!=this.map.getZoom()&&this.isValidZoomLevel(zoom)?this.map.moveTo(a,b,{dragging:void 0,forceZoomChange:void 0}):this.map.moveTo(a,null,{dragging:void 0,forceZoomChange:void 0})},unFocusAll:function(a){for(var b=this.layers||[this.layer],c=0;c<b.length;c++){var d=b[c];this.unFocusLayer(d,a)}},unFocusLayer:function(a,b){if(null!=a.selectedFeatures)for(var c=0;c<a.selectedFeatures.length;c++){var d=a.selectedFeatures[c];null!=d&&(this.unhighlight(d),OpenLayers.Util.removeItem(a.selectedFeatures,d),b||a.events.triggerEvent("featureunselected",{feature:d}),this.onUnselect.call(this.scope,d),this.unFocusOnItem(d))}},unFocusOnItem:function(a){var b=a.attributes,c=b.btn;void 0!=c&&OpenLayers.Element.removeClass(c,"x-btn-pressed"),this.targetFeature=void 0,this.targetLocation=void 0,this.moveEndListener=null,this.clearPopupTimers(),this.clearSnapshotTimers(),this.clearChartTimers(),this.closeCurrentPopup()},isCompiled:function(a){for(var b=!0,c=a.layer,d=c.strategies[0],e=0;e<d.getNumberOfJobs();e++){var f=d.getJob(e);b=b&&d.isFeatureCompiled.apply(d,[a,f.id])}return b},atCenter:function(a){return a.equals(this.map.getCenter())},closeToCenter:function(a){var b=!1,c=void 0,d=this.map.getZoom();if("EPSG:900913"==this.map.getProjection()&&(c=.01/Math.pow(2,d)),void 0!=c){var e=this.map.getCenter(),f=Math.sqrt(Math.pow(a.lat-e.lat,2)+Math.pow(a.lon-e.lon,2));b=c>f}return b},getMaxDistance:function(){var a=this.map.getZoom(),b=void 0;return b="EPSG:900913"==this.map.getProjection()?18==a?15:17==a?25:16==a?50:15==a?100:14==a?200:13==a?400:12==a?800:11==a?1600:10==a?3200:9==a?6400:8==a?1e4:7==a?2e4:6==a?4e4:5==a?6e4:4==a?8e4:3==a?1e5:2==a?12e4:24e4:8==a?.25:7==a?.5:6==a?1:5==a?1.5:4==a?2:3==a?2.5:2==a?3:6},getNearbyFeatures:function(a,b){var c=this.getMaxDistance(),d=$.grep(b,function(b,d){var e=!1;if(("OpenLayers.Geometry.Collection"==b.geometry.CLASS_NAME||"OpenLayers.Geometry.Polygon"==b.geometry.CLASS_NAME||"OpenLayers.Geometry.MultiPolygon"==b.geometry.CLASS_NAME)&&b.geometry.intersects(a)&&(e=!0),0==e){var f=a.distanceTo(b.geometry);e=c>f}return e});return d},getRadius:function(a){var b=void 0,c=this.map.getZoom();return b="EPSG:900913"==this.map.getProjection()?614400/Math.pow(2,c)*((a-1-(a-1)%4)/4)+75e5/Math.pow(2,c):1/c*((a-1-(a-1)%4)/4)+8/c},createWheel:function(a,b,c){var d=this.createWheelFeatures(a,b,c),e=this.createWheelPointLayer(b,d.points),f=this.createWheelLineLayer(b,d.lines),g=this.createWheelCloseLayer(b,d.close);return{target:b,points:e,lines:f,close:g,select:this.createWheelControl(e,g)}},createWheelPointLayer:function(a,b){var c=new OpenLayers.Layer.Vector("Selection Points",{styleMap:this.getWheelPointStyleMap(a.layer),popupWidth:a.layer.options.popupWidth,popupHeight:a.layer.options.popupHeight});return c.addFeatures(b),c},createWheelLineLayer:function(a,b){var c=new OpenLayers.Layer.Vector("Selection Lines",{styleMap:this.getWheelLineStyleMap(a.layer)});return c.addFeatures(b),c},createWheelCloseLayer:function(a,b){var c=new OpenLayers.Layer.Vector("Close Wheel",{styleMap:this.getWheelCloseStyleMap(a.layer)});return c.addFeatures(b),c},createWheelFeatures:function(a,b,c){var d=[],e=[],f=c.length,g=this.getRadius(f);if(4>=f){var h=void 0,i=void 0;h=c[0],h.attributes.wheel="on",i=h.clone(),i.link=h,i.attributes={close:"off",anchorPosition:"top-right",wheel:"off",hover:"off"},i.attributes=OpenLayers.Util.applyDefaults(i.attributes,h.attributes),i.geometry=new OpenLayers.Geometry.Point(a.x-g,a.y-g),d.push(i),e.push(this.createWheelLine(a,i.geometry)),h=c[1],h.attributes.wheel="on",i=h.clone(),i.link=h,i.attributes={close:"off",anchorPosition:"top-left",wheel:"off",hover:"off"},i.attributes=OpenLayers.Util.applyDefaults(i.attributes,h.attributes),i.geometry=new OpenLayers.Geometry.Point(a.x+g,a.y-g),d.push(i),e.push(this.createWheelLine(a,i.geometry)),f>=3&&(h=c[2],h.attributes.wheel="on",i=h.clone(),i.link=h,i.attributes={close:"off",anchorPosition:"bottom-left",wheel:"off",hover:"off"},i.attributes=OpenLayers.Util.applyDefaults(i.attributes,h.attributes),i.geometry=new OpenLayers.Geometry.Point(a.x+g,a.y+g),d.push(i),e.push(this.createWheelLine(a,i.geometry)),f>=4&&(h=c[3],h.attributes.wheel="on",i=h.clone(),i.link=h,i.attributes={close:"off",anchorPosition:"bottom-right",wheel:"off",hover:"off"},i.attributes=OpenLayers.Util.applyDefaults(i.attributes,h.attributes),i.geometry=new OpenLayers.Geometry.Point(a.x-g,a.y+g),d.push(i),e.push(this.createWheelLine(a,i.geometry))))}else for(var j=0,k=360/f,l=0;f>l;l++){var h=c[l];h.attributes.wheel="on";var m=this.createWheelSection(a,h,g,j);d.push(m.point),e.push(m.line),j+=k}var n=this.createCloseFeature(a,b);return{points:d,lines:e,close:n}},createCloseFeature:function(a,b){var c=b.clone();return c.attributes={close:"on"},c.geometry=a.clone(),c},createWheelSection:function(a,b,c,d){var e=b.clone();e.link=b,e.attributes={close:"off",anchorPosition:this.getAnchorPosition(d),wheel:"off",hover:"off"},e.attributes=OpenLayers.Util.applyDefaults(e.attributes,b.attributes),e.geometry=new OpenLayers.Geometry.Point(a.x,a.y),this.placeWheelPoint(a,e,d,c);var f=this.createWheelLine(a,e.geometry);return{point:e,line:f}},getAnchorPosition:function(a){var b="";return b=45>a?"top-left":135>a?"left":180>a?"bottom-left":225>a?"bottom-right":315>a?"right":"top-right"},placeWheelPoint:function(a,b,c,d){b.geometry.move(0,-d),b.geometry.rotate(c,a)},createWheelLine:function(a,b){return new OpenLayers.Feature.Vector(new OpenLayers.Geometry.LineString([a.clone(),b.clone()]))},setWheel:function(a){this.wheel=a,this.map.addLayer(a.points),this.map.addLayer(a.lines),this.map.addLayer(a.close),this.map.addControl(a.select),a.select.activate()},getWheel:function(a){return this.wheel},isWheelOpen:function(){return void 0!=this.wheel},isWheelClosed:function(){return void 0==this.wheel},stopWheelTimer:function(){void 0!=this.wheelTimer&&(clearTimeout(this.wheelTimer),this.wheelTimer=void 0)},delayWheelTimer:function(){var a=this;a.stopWheelTimer(),a.wheelTimer=setTimeout(function(){a.closeWheel()},a.wheelDelay)},finishWheelTimer:function(){this.stopWheelTimer(),this.closeWheel()},closeWheel:function(){if(this.isWheelOpen()){var a=this.getWheel();a.points.selectedFeatures.length>0&&this.closeCurrentPopup(),a.select.destroy(),a.points.destroy(),a.lines.destroy(),a.close.destroy(),$.each(a.target.layer.features,function(a,b){b.attributes.wheel="off"}),a.target.layer.redraw(),this.wheel=void 0,this.triggerWheelCloseListener(a.target.layer)}},createWheelControl:function(a,b){var c=new OpenLayers.Control.AdvancedSelectFeatureWheel([a,b],{primary:this});return c},clickFeature:function(a,b,c){if(this.isWheelClosed()){var d=(this.getLayerIndex(a.layer),$.inArray(a,a.layer.selectedFeatures)>-1);if(d)this.toggleSelect()?this.unselect(a):this.multipleSelect()||this.unselectAll({except:a});else if(this.multipleSelect()||this.unselectAll({except:a}),"OpenLayers.Geometry.Point"==a.geometry.CLASS_NAME){this.stopWheelTimer();var e=a.geometry,f=this.getNearbyFeatures(a.geometry,a.layer.features),g=f.length;if(1==g)this.select(a),this.focusOnItem(a,e);else{this.map.panTo(e.getBounds().getCenterLonLat());var h=this.createWheel(e,a,f);this.setWheel(h),a.layer.redraw(),this.delayWheelTimer(),this.triggerWheelOpenListener(a.layer)}}else{if("OpenLayers.Geometry.Collection"!=a.geometry.CLASS_NAME&&"OpenLayers.Geometry.Polygon"!=a.geometry.CLASS_NAME&&"OpenLayers.Geometry.MultiPolygon"!=a.geometry.CLASS_NAME)return void this.select(a);this.stopWheelTimer();var i=this.map.getLonLatFromPixel(this.handlers.feature.evt.xy),e=new OpenLayers.Geometry.Point(i.lon,i.lat),f=this.getNearbyFeatures(e,a.layer.features),g=f.length;if(1==g)this.select(a),this.focusOnItem(a,e);else{this.map.panTo(e.getBounds().getCenterLonLat());var h=this.createWheel(e,a,f);this.setWheel(h),a.layer.redraw(),this.delayWheelTimer(),this.triggerWheelOpenListener(a.layer)}}}},clickoutFeature:function(a){this.unselectAll()},initialize:function(a,b){var c={multiple:!1,clickout:!0,hover:!0};b=void 0==b?c:OpenLayers.Util.applyDefaults(b,c),OpenLayers.Control.prototype.initialize.apply(this,[b]),null===this.scope&&(this.scope=this),this.initLayer(a);var d={click:this.clickFeature,clickout:this.clickoutFeature};this.hover&&(d.over=this.overFeature,d.out=this.outFeature),this.callbacks=OpenLayers.Util.extend(d,this.callbacks),this.handlers={feature:new OpenLayers.Handler.Feature(this,this.layer,this.callbacks,{stopDown:this.stopDown,geometryTypes:this.geometryTypes})},this.box&&(this.handlers.box=new OpenLayers.Handler.Box(this,{done:this.selectBox},{boxDivClassName:"olHandlerBoxSelectFeature"})),this.init_layers(a,b)},init_layers:function(a,b){for(var c=0;c<a.length;c++)this.init_layer(a[c],b)},init_layer:function(a,b){var c=this;a.events.on({featureunselected:function(a){c.onFeatureUnselected.apply(c,[a])}})},activate:function(){return this.active||void 0!=this.handlers&&void 0!=this.handlers.drag&&this.handlers.drag.activate(),OpenLayers.Control.SelectFeature.prototype.activate.apply(this,arguments)},deactivate:function(){return this.active&&void 0!=this.handlers&&void 0!=this.handlers.drag&&this.handlers.drag.deactivate(),OpenLayers.Control.SelectFeature.prototype.deactivate.apply(this,arguments)},setMap:function(a){OpenLayers.Control.SelectFeature.prototype.setMap.apply(this,arguments),void 0!=this.handlers&&void 0!=this.handlers.drag&&this.handlers.drag.setMap(a);var b=this;a.events.register("zoomend",this,function(){b.onZoomEnd.apply(b)})},panMapStart:function(){return!0},panMap:function(a){return!0},panMapDone:function(a){return!0},onFeatureUnselected:function(a){this.isLocked()||this.unFocusOnItem(a.feature)},CLASS_NAME:"OpenLayers.Control.AdvancedSelectFeature"}),OpenLayers.Control.AdvancedSelectFeatureWheel=OpenLayers.Class(OpenLayers.Control.SelectFeature,{primary:void 0,isAnimated:function(){return this.primary.isAnimated.apply(this.primary)},getPrimary:function(){return this.primary},closeCurrentPopup:function(){this.primary.closeCurrentPopup.apply(this.primary)},clearLock:function(){this.primary.clearLock.apply(this.primary)},isLocked:function(){this.primary.isLocked.apply(this.primary)},isJITLayer:function(a){return this.primary.isJITLayer.apply(this.primary,[a])},clearJITQueue:function(){return this.primary.clearJITQueue.apply(this.primary)},jit_request:function(a,b){return this.primary.jit_request.apply(this.primary,[a,b])},isCompiled:function(a){return this.primary.isCompiled.apply(this.primary,[a])},queueJIT:function(a,b,c,d,e){return this.primary.queueJIT.apply(this.primary,[a,b,c,d,e])},focusOnItem:function(a){this.clearLock(),this.stopWheelTimer();var b=a.attributes,c=a.link.attributes.btn;if(this.isJITLayer(a.link.layer)&&(this.clearJITQueue(),this.jit_request(a.link,!0)),void 0!=c&&OpenLayers.Element.addClass(c,"x-btn-pressed"),this.hasPopup(a.link.layer))if(this.isJITLayer(a.link.layer))if(this.isCompiled(a.link)){var d=this,e=function(){setTimeout(function(){d.unselect(a)},0)};this.queuePopupFunction_Core(a,a.link.layer,a.link.attributes,a.geometry,b.anchorPosition,e)}else this.queueJIT(a,a.link.layer,a.link.attributes,a.geometry,b.anchorPosition);else{var d=this,e=function(){setTimeout(function(){d.unselect(a)},0)};this.queuePopupFunction_Core(a,a.link.layer,a.link.attributes,a.geometry,b.anchorPosition,e)}},unFocusOnItem:function(a){this.primary.unFocusOnItem.apply(this.primary,[a])},atCenter:function(a){return this.primary.atCenter.apply(this.primary,[a])},hasPopup:function(a){return this.primary.hasPopup.apply(this.primary,[a])},queuePopupFunction_Core:function(a,b,c,d,e,f){return this.primary.queuePopupFunction_Core.apply(this.primary,[a,b,c,d,e,f])},stopWheelTimer:function(){this.primary.stopWheelTimer.apply(this.primary)},delayWheelTimer:function(){this.primary.delayWheelTimer.apply(this.primary)},finishWheelTimer:function(){this.primary.finishWheelTimer.apply(this.primary)},isCloseFeature:function(a){return void 0!=a.attributes.close?"on"==a.attributes.close:!1},overFeature:function(a){(void 0==a.attributes.hover||"off"==a.attributes.hover)&&(a.attributes.hover="on",a.layer.redraw())},outFeature:function(a){"on"==a.attributes.hover&&(a.attributes.hover="off",a.layer.redraw())},clickFeature:function(a){if(this.isCloseFeature(a))this.finishWheelTimer();else{var b=OpenLayers.Util.indexOf(a.layer.selectedFeatures,a)>-1;b?this.toggleSelect()?this.unselect(a):this.multipleSelect()||this.unselectAll({except:a}):(this.multipleSelect()||this.unselectAll({except:a}),this.select(a),this.focusOnItem(a))}},initialize:function(a,b){var c={multiple:!1,clickout:!0,hover:!0};b=void 0==b?c:OpenLayers.Util.applyDefaults(b,c),OpenLayers.Control.SelectFeature.prototype.initialize.apply(this,[a,b]),this.init_layers(a,b)},init_layers:function(a,b){for(var c=0;c<a.length;c++)this.init_layer(a[c],b)},init_layer:function(a,b){var c=this;a.events.on({featureselected:function(a){c.onFeatureSelected.apply(c,[a])},featureunselected:function(a){c.onFeatureUnselected.apply(c,[a])}})},onFeatureSelected:function(a){},onFeatureUnselected:function(a){this.isLocked()||(this.unFocusOnItem(a.feature),this.delayWheelTimer())},CLASS_NAME:"OpenLayers.Control.AdvancedSelectFeatureWheel"}),OpenLayers.Control.Bookmarks=OpenLayers.Class(OpenLayers.Control,{daysoftheweek:["Sunday","Monday","Tuesday","Wednesday","Thursday","Friday","Saturday"],monthsoftheyear:["January","February","March","April","May","June","July","August","September","October","November","December"],type:"static",mainDiv:void 0,bookmarks:void 0,bookmarkContainers:void 0,listener:void 0,passthroughEvents:!1,blackholeEvents:!1,layer:null,layers:null,focusControl:void 0,bHide:!1,bFade:!0,setFocusControl:function(a){this.focusControl=a},hasFocusControl:function(){return void 0!=this.focusControl},getFocusControl:function(){return this.focusControl},setLayer:function(a){var b=this;this.layer=a,a.events.register("featuresadded",a,function(){b.refresh.apply(b)})},setLayers:function(a){var b=this;this.layers=a;for(var c=0;c<a.length;c++){var d=a[c];d.events.register("featuresadded",d,function(){b.refresh.apply(b)})}},refresh:function(){void 0!=this.layer?this.refreshLayers([this.layer],this.bookmarks,this.bookmarkContainers):void 0!=this.layers?this.refreshLayers(this.layers,this.bookmarks,this.bookmarkContainers):this.refreshLayers(void 0,this.bookmarks,this.bookmarkContainers)},refreshLayers:function(a,b,c){for(var d=0;d<b.length;d++){var e=b[d],f=$(c[d]);if(void 0!=e&&(e.refresh.apply(e,[this.map,a,this.map.getProjectionObject()]),void 0!=f)){var g=e.hasTarget.apply(e);g?f.removeClass("hidden fade"):this.bHide?(f.removeClass("fade"),f.addClass("hidden")):this.bFade?(f.removeClass("hidden"),f.addClass("fade")):f.removeClass("hidden fade")}}},setBookmarks:function(a){var b=[];if(void 0!=a)for(var c=0;c<a.length;c++)b.push(new OpenLayers.Bookmark(a[c]));this.bookmarks=b},isAnimated:function(){return this.animate},getMaxWidth:function(){return OpenLayers.Element.hasClass(this.mainDiv,"collapsed")?this.collapsedMaxWidth:this.expandedMaxWidth},setMap:function(a){OpenLayers.Control.prototype.setMap.apply(this,[a]);var b=this;a.events.register("changebaselayer",a,function(){b.refresh.apply(b)})},initialize:function(a,b,c){OpenLayers.Control.prototype.initialize.apply(this,[c]),void 0!=b?OpenLayers.Util.isArray(b)?this.setBookmarks(b):this.setBookmarks([b]):this.setBookmarks(void 0),OpenLayers.Util.isArray(a)?this.setLayers(a):this.setLayer(a),void 0!=c&&void 0!=c.focusControl&&this.setFocusControl(c.focusControl)},draw:function(){var a=OpenLayers.Control.prototype.draw.apply(this);this.bookmarkContainers=this.createBookmarkContainers(this.bookmarks);for(var b=0;b<this.bookmarkContainers.length;b++)a.appendChild(this.bookmarkContainers[b]);this.mainDiv=a,$(a).on("click dblclick",".olControlBookmark",function(a){var b=$(this).data("olControlBookmarks"),c=$(this).data("bookmark");b.onBookmarkClick.apply(b,[a,c]),b.blackhole.apply(b,[a])});var c=this.map.events;return c.registerPriority("click",this,this.onMapClick),a},createBookmarkContainers:function(){var a=[];if(void 0!=this.bookmarks)for(var b=0;b<this.bookmarks.length;b++){var c=this.createBookmarkContainer(this.bookmarks[b]);a.push(c)}return a},createBookmarkContainer:function(a){var b=document.createElement("div");b.className="olControlBookmarkContainer",$(b).data("olControlBookmarks",this),$(b).data("bookmark",a);var c=document.createElement("div");c.className="olControlBookmark",$(c).data("olControlBookmarks",this),$(c).data("bookmark",a),b.appendChild(c);var d=document.createElement("span");d.className="olControlBookmarkLabel",d.innerHTML=a.getLabel(),c.appendChild(d);var e=document.createElement("span");return e.className="olControlBookmarkArrow",e.innerHTML="&rarr;",c.appendChild(e),b},onBookmarkClick:function(a,b){if(this.hasFocusControl())if(b.isLocationBookmark()){if(b.hasTarget()){var c=b.getTargetLocation(),d=b.getTargetZoom(this.map),e=b.getTargetTime(),f=this.getFocusControl();f.unFocusAll.apply(f,[!0]),f.focusOnItem.apply(f,[void 0,c,d,e])}}else if(b.isFeatureBookmark()&&b.hasTarget()){var g=b.getTargetFeature(),c=b.getTargetLocation(),d=b.getTargetZoom(this.map),e=b.getTargetTime(),f=this.getFocusControl();f.unFocusAll.apply(f,[!0]),f.select.apply(f,[g]),f.focusOnItem.apply(f,[g,c,d,e])}},setZIndex:function(a,b){for(var c=this.bookmarkContainers,d=0;d<c.length;d++){var e=c[d];e.style.zIndex=a+b}},passthrough:function(a){return!1},blackhole:function(a){a.stopPropagation()},onMapClick:function(){},onMapResize:function(){this._resizeBookmarks()},_resizeBookmarks:function(){},onFeatureUnselected:function(a){this.clearAutocompleteTarget()},setAutocompleteTarget:function(a){if(this.acTarget!=a&&(this.acTarget=a,this.hasFocusControl())){var b=a.geometry,c=this.getFocusControl();c.unFocusAll.apply(c,[!0]),c.select.apply(c,[a]),c.focusOnItem.apply(c,[a,b])}},clearAutocompleteTarget:function(){this.acTarget=void 0,$(this.searchInput).val(""),this.validateAutocomplete.apply(this,[this.searchInput])},destroy:function(){this.sliderEvents.un({touchstart:this.zoomBarDown,touchmove:this.zoomBarDrag,touchend:this.zoomBarUp,mousedown:this.zoomBarDown,mousemove:this.zoomBarDrag,mouseup:this.zoomBarUp}),this.sliderEvents.destroy()},CLASS_NAME:"OpenLayers.Control.Bookmarks"}),OpenLayers.Bookmark=OpenLayers.Class({config:void 0,allLayers:void 0,targetSelector:void 0,targetProjection:void 0,targetLayer:void 0,targetFeature:void 0,targetLocation:void 0,targetZoom:void 0,targetTime:void 0,initialize:function(a,b){this.displayClass=this.CLASS_NAME.replace("CyberGIS.","cybergis-").replace(/\./g,""),OpenLayers.Util.extend(this,b),null==this.id&&(this.id=OpenLayers.Util.createUniqueID(this.CLASS_NAME+"_")),this.config=a},getType:function(){return this.config.type},isLocationBookmark:function(){return"location"==this.config.type},isFeatureBookmark:function(){return"feature"==this.config.type},getLabel:function(){return this.config.label},refresh:function(a,b,c){this.allLayers=b,this.targetProjection=c,this.isFeatureBookmark()&&(this.targetSelector=this.config.selector,this.targetLayer=this.buildTargetLayer(),this.targetFeature=this.buildTargetFeature()),this.targetLocation=this.buildTargetLocation(),this.isLocationBookmark()&&(this.targetZoom=this.buildTargetZoom(a)),this.targetTime=this.buildTargetTime(a)},buildTargetLayer:function(){for(var a=void 0,b=0;b<this.allLayers.length;b++){var c=this.allLayers[b];if(c.options.proto==this.targetSelector.layer){a=c;break}}return a},buildTargetFeature:function(){var a=void 0;if(void 0!=this.targetLayer)for(var b=0;b<this.targetLayer.features.length;b++){var c=this.targetLayer.features[b];if(this.isCandidateFeature(c,this.targetSelector.where)){a=c;break}}return a},isCandidateFeature:function(a,b){var c=a.attributes;return"="==b.op||"=="==b.op?c[""+b.field]==b.value:"!="==b.op||"<>"==b.op?c[""+b.field]!=b.value:"not in"==b.op||"notin"==b.op||"not_in"==b.op?-1==$.inArray(c[""+b.field],b.values):!1},buildTargetLocation:function(){var a=void 0;if(void 0!=this.config.location)if("string"==typeof this.config.location){var b=this.config.location.split(","),c=parseFloat(b[0]),d=parseFloat(b[1]);parseInt(b[2],10);if(void 0!=c&&void 0!=d){var e=new OpenLayers.Projection("EPSG:4326"),f=new OpenLayers.LonLat(d,c);a=f.transform(e,this.targetProjection)}}else{var c=this.config.location.longitude,d=this.config.location.latitude,g=this.config.location.x,h=this.config.location.y;if(void 0!=c&&void 0!=d){var e=new OpenLayers.Projection("EPSG:4326"),f=new OpenLayers.LonLat(c,d);a=f.transform(e,this.targetProjection)}else void 0!=g&&void 0!=h&&(a=new OpenLayers.LonLat(g,h))}return void 0==a&&this.isFeatureBookmark()&&void 0!=this.targetFeature&&(a=this.targetFeature.geometry.getBounds().getCenterLonLat()),a},buildTargetZoom:function(a){var b=void 0;if(void 0!=this.config.location)if("string"==typeof this.config.location){var c=this.config.location.split(","),d=parseInt(c[2],10);void 0!=d&&(b=d)}else{var d=this.config.location.zoom;void 0!=d&&(b=d)}if(void 0==b&&this.isFeatureBookmark()){var e=this.getTargetLayer(),f=a.getZoom();if(e.inRange)b=f;else{var g=$.inArray(e.minResolution,a.resolutions),h=$.inArray(e.maxResolution,a.resolutions);f>g?b=g:h>f&&(b=h)}}return b},buildTargetTime:function(a){var b=void 0;return void 0!=this.config.time&&"string"==typeof this.config.time&&(b=CyberGIS.Date.parseDate(this.config.time)),b},getTargetLayer:function(){return this.targetLayer},getTargetFeature:function(){return this.targetFeature},getTargetLocation:function(){return this.targetLocation},getTargetZoom:function(a){return this.isLocationBookmark()||this.isFeatureBookmark()&&(this.targetZoom=this.buildTargetZoom(a)),this.targetZoom},getTargetTime:function(){return this.targetTime},hasTarget:function(){var a=!1;return this.isLocationBookmark()?a=void 0!=this.targetLocation:this.isFeatureBookmark()&&(a=void 0!=this.targetFeature&&void 0!=this.targetLocation),a},buildTargets:function(){var a=void 0;if("location"==bookmark.type)if("string"==typeof bookmark.location){var b=bookmark.location.split(","),c=parseFloat(b[0]),d=parseFloat(b[1]);parseInt(b[2],10);if(void 0!=c&&void 0!=d){var e=new OpenLayers.Projection("EPSG:4326"),f=new OpenLayers.LonLat(d,c);a=f.transform(e,this.map.getProjectionObject())}}else{var c=bookmark.location.longitude,d=bookmark.location.latitude;if(void 0!=c&&void 0!=d){var e=new OpenLayers.Projection("EPSG:4326"),f=new OpenLayers.LonLat(d,c);a=f.transform(e,this.map.getProjectionObject())}}else if("feature"==bookmark.type){var g=this.map.getLonLatFromPixel(this.handlers.feature.evt.xy);a=new OpenLayers.Geometry.Point(g.lon,g.lat)}return a},destroy:function(){},CLASS_NAME:"CyberGIS.DataSources"}),OpenLayers.Control.Box=OpenLayers.Class(OpenLayers.Control,{mainDiv:void 0,middle:void 0,mainLabel:void 0,listener:void 0,updateDelay:2e3,animate:!0,expandedMaxWidth:380,collapsedMaxWidth:220,padding:40,layer:null,sLayer:null,sBox:null,boxData:void 0,boxPadding:{vertical:16,horizontal:0},boxWidth:340,boxHeight:248,boxFields:void 0,isAnimated:function(){return this.animate},getMaxWidth:function(){return OpenLayers.Element.hasClass(this.mainDiv,"expanded")?this.expandedMaxWidth:this.collapsedMaxWidth},collapse:function(){if(this.collapseTimer=void 0,OpenLayers.Element.hasClass(this.mainDiv,"expanded")&&OpenLayers.Element.removeClass(this.mainDiv,"expanded"),$(this.mainDiv).stop(!0,!1),this.isAnimated()){var a=this.map,b=Math.min(a.getCurrentSize().w-this.padding,this.getMaxWidth()),c=-1*(b/2)-this.padding/4;$(this.mainDiv).animate({width:b,"margin-left":c})}},expand:function(){if(OpenLayers.Element.hasClass(this.mainDiv,"expanded")||OpenLayers.Element.addClass(this.mainDiv,"expanded"),$(this.mainDiv).stop(!0,!1),this.isAnimated()){var a=this.map,b=Math.min(a.getCurrentSize().w-this.padding,this.getMaxWidth()),c=-1*(b/2)-this.padding/4;
$(this.mainDiv).animate({width:b,"margin-left":c})}},setLayer:function(a){var b=this;this.layer=a,this.layer.events.register("loadend",this.layer,function(){b.refresh.apply(b)}),this.layer.events.register("featuresadded",this.layer,function(){b.refresh.apply(b)})},initialize:function(a,b,c,d){OpenLayers.Control.prototype.initialize.apply(this,[d]);try{this.setLayer(a),this.sLayer=b,this.sBox=c,this.boxData={}}catch(e){throw console.log(e),e}},draw:function(){var a=OpenLayers.Control.prototype.draw.apply(this),b=document.createElement("div");b.className="olControlBoxMiddle olControlMiddle";var c=document.createElement("div");c.className="olControlBoxLabel",$(c).data("olControlBox",this);var d=document.createElement("span");d.innerHTML="Box - Click to Open",c.appendChild(d),b.appendChild(c);var e=document.createElement("div");e.className="olControlBoxContainer";var f=this.createBoxHeading();$(f).data("olControlBox",this),$(f).click(function(){var a=$(this).data("olControlBox");a.onBoxHeadingClick.apply(a)}),e.appendChild(f),this.boxFields=this.createBoxFields();for(var g=0;g<this.boxFields.length;g++)e.appendChild(this.boxFields[g]);return b.appendChild(e),a.appendChild(b),this.mainDiv=a,$(c).click(function(){var a=$(this).data("olControlBox");a.onMainLabelClick.apply(a)}),a},refresh:function(){this.refreshBoxData(),this.refreshBoxFields()},refreshBoxData:function(){if(CyberGIS.isString(this.sLayer)&&CyberGIS.isString(this.sBox)){var a={},b=CyberGIS.getJSON(["layers",this.sLayer,"boxes",this.sBox,"tasks"],this.carto);if(void 0!=b)for(var c=0;c<b.length;c++){var d=b[c],e=this.calc(d,this.layer);a[""+d.output]=e}this.boxData=a}else this.boxData={};return this.boxData},refreshBoxFields:function(){if(CyberGIS.isArray(this.boxFields))for(var a=0;a<this.boxFields.length;a++){var b=this.boxFields[a];this.refreshBoxField(b,$(b).data("boxField"))}},refreshBoxField:function(a,b){if(void 0!=a)if(void 0!=b)if(CyberGIS.isString(b.name)){var c="";c=void 0!=this.boxData[""+b.name]?this.formatValue(this.boxData[""+b.name],b.type,b.format):"Not given",$(".olControlBoxItemValue",a).html("<span>"+c+"</span>")}else $(".olControlBoxItemValue",a).html("<span>Not given</span>");else $(".olControlBoxItemValue",a).html("<span>Not given</span>")},calc:function(a,b){if("concat"==a.op);else if("count"==a.op);else{if("sum"==a.op)return this.calc_sum(b.features,a.input,a.where);if("min"==a.op);else if("max"==a.op);else if("avg"==a.op);else if("strip_fields"==a.op);else if("strip_array"==a.op);else if("first"==a.op)return this.calc_first(b.features,a.input,a.where)}},calc_sum:function(a,b,c){var d=0;if(void 0!=c)if("="==c.op||"=="==c.op)for(var e=0;e<a.length;e++){var f=a[e].attributes;f[""+c.field]==c.value&&(d+=parseInt(f[""+b]))}else if("!="==c.op||"<>"==c.op)for(var e=0;e<a.length;e++){var f=a[e].attributes;f[""+c.field]!=c.value&&(d+=parseInt(f[""+b]))}else if("not in"==c.op||"notin"==c.op||"not_in"==c.op)for(var e=0;e<a.length;e++){var f=a[e].attributes;-1==$.inArray(f[""+c.field],c.values)&&(d+=parseInt(f[""+b]))}else for(var e=0;e<a.length;e++){var f=a[e].attributes;d+=parseInt(f[""+b])}else for(var e=0;e<a.length;e++){var f=a[e].attributes;d+=parseInt(f[""+b])}return d},calc_first:function(a,b,c){var d=void 0;if(a.length>0)if(void 0!=c)if("="==c.op||"=="==c.op)for(var e=0;e<a.length;e++){var f=a[e].attributes;if(f[""+c.field]==c.value){d=f[""+b];break}}else if("!="==c.op||"<>"==c.op)for(var e=0;e<a.length;e++){var f=a[e].attributes;if(f[""+c.field]!=c.value){d=f[""+b];break}}else if("not in"==c.op||"notin"==c.op||"not_in"==c.op)for(var e=0;e<a.length;e++){var f=a[e].attributes;if(-1==$.inArray(f[""+c.field],c.values)){d=f[""+b];break}}else d=a[0].attributes[""+b];else d=a[0].attributes[""+b];return d},onBoxHeadingClick:function(){this.isAnimated()?this.expand():OpenLayers.Element.hasClass(this.mainDiv,"collapsed")||OpenLayers.Element.addClass(this.mainDiv,"collapsed")},onMainLabelClick:function(){this.isAnimated()?this.expand():OpenLayers.Element.hasClass(this.mainDiv,"collapsed")&&OpenLayers.Element.removeClass(this.mainDiv,"collapsed")},onMapResize:function(){},getMaximumboxWidth:function(a){var b=340;return void 0!=a&&(b=a>1e3?340:240),b},getMaximumboxHeight:function(a){var b=248;return void 0!=a&&(b=a>700?248:a>360?168:138),b},createBoxHeading:function(){var a=CyberGIS.getJSON(["layers",this.sLayer,"boxes",this.sBox,"title"],this.carto),b=document.createElement("div");b.className="olControlBoxItem";var c=document.createElement("div");return c.className="olControlBoxHeading",$(c).html("<div><span>"+a+"</span></div>"),b.appendChild(c),b},createBoxFields:function(){var a=CyberGIS.getJSON(["layers",this.sLayer,"boxes",this.sBox,"fields"],this.carto),b=[];if(CyberGIS.isArray(a))for(var c=0;c<a.length;c++)b.push(this.createBoxField(a[c]));return b},createBoxField:function(a){var b=document.createElement("div");return b.className="olControlBoxItem",$(b).data("olControlBox",this),$(b).data("boxField",a),void 0!=a.label&&b.appendChild(this.createBoxFieldLabel(a)),void 0!=a.name&&b.appendChild(this.createBoxFieldValue(a)),b},createBoxFieldLabel:function(a){var b=a.label||"",c=document.createElement("div");return c.className="olControlBoxItemLabel",$(c).html("<span>"+b+":</span>"),c},createBoxFieldValue:function(a){var b="";b=void 0!=this.boxData[""+a.name]?this.formatValue(this.boxData[""+a.name],a.type,a.format):"Not given";var c=document.createElement("div");return c.className="olControlBoxItemValue",$(c).html("<span>"+b+"</span>"),c},formatValue:function(a,b,c){return"integer"==b||"int"==b?1==c?CyberGIS.Number.formatInteger(a):2==c?CyberGIS.Number.formatInteger2(a):3==c?CyberGIS.Number.formatInteger3(a):CyberGIS.Number.formatInteger(a):a},destroy:function(){},CLASS_NAME:"OpenLayers.Control.Box"}),OpenLayers.Control.Disclaimer=OpenLayers.Class(OpenLayers.Control,{mode:"hover",rounded:!0,leftText:"Names and boundary representation are not necessarily authoritative.",middleText:'Names and boundary representation are not necessarily authoritative.<br>Basemap: <a href="http://state.gov">U.S. Department of State</a>',rightText:'Basemap: <a href="http://state.gov">U.S. Department of State</a>',mainDiv:void 0,leftContainer:void 0,rightContainer:void 0,middleContainer:void 0,isHover:function(){return"hover"==this.mode},isFixed:function(){return"fixed"==this.mode},isRounded:function(){return 1==this.rounded},initialize:function(a){OpenLayers.Control.prototype.initialize.apply(this,[a])},draw:function(){var a=OpenLayers.Control.prototype.draw.apply(this);this.isHover()?OpenLayers.Element.addClass(a,"hover"):this.isFixed()&&OpenLayers.Element.addClass(a,"fixed"),this.isRounded()&&OpenLayers.Element.addClass(a,"rounded"),this.leftContainer=document.createElement("div"),this.leftContainer.className="olControlDisclaimerContainerLeft olControlDisclaimerContainer";var b=document.createElement("div");b.className="olControlDisclaimerBodyLeft olControlDisclaimerBody";var c=document.createElement("span");c.innerHTML=this.leftText,b.appendChild(c),this.leftContainer.appendChild(b),a.appendChild(this.leftContainer),this.rightContainer=document.createElement("div"),this.rightContainer.className="olControlDisclaimerContainerRight olControlDisclaimerContainer";var d=document.createElement("div");d.className="olControlDisclaimerBodyRight olControlDisclaimerBody";var e=document.createElement("span");e.innerHTML=this.rightText,d.appendChild(e),this.rightContainer.appendChild(d),a.appendChild(this.rightContainer),this.middleContainer=document.createElement("div"),this.middleContainer.className="olControlDisclaimerContainerMiddle olControlDisclaimerContainer";var f=document.createElement("div");f.className="olControlDisclaimerBodyMiddle olControlDisclaimerBody";var g=document.createElement("span");return g.innerHTML=this.middleText,f.appendChild(g),this.middleContainer.appendChild(f),a.appendChild(this.middleContainer),this.mainDiv=a,a},setZIndex:function(a,b){this.leftContainer.style.zIndex=a+b,this.rightContainer.style.zIndex=a+b,this.middleContainer.style.zIndex=a+b},onMapResize:function(){},destroy:function(){this.sliderEvents.un({touchstart:this.zoomBarDown,touchmove:this.zoomBarDrag,touchend:this.zoomBarUp,mousedown:this.zoomBarDown,mousemove:this.zoomBarDrag,mouseup:this.zoomBarUp}),this.sliderEvents.destroy()},CLASS_NAME:"OpenLayers.Control.Disclaimer"}),OpenLayers.Control.Focus=OpenLayers.Class(OpenLayers.Control,{stopDown:!0,animate:!0,moveEndTargetLocation:void 0,zoomEndTargetLevel:void 0,bFocusFeature:!1,bFocusLocation:!0,isAnimated:function(){return this.animate},panComplete:function(a){console.log("panComplete()");var b=this.zoomEndTargetLevel;if(void 0!=b&&b!=this.map.getZoom()&&this.map.isValidZoomLevel(b)&&(this.zoomEndTargetLevel=void 0,this.zoomTo(b,!0),this.map.events.triggerEvent("zoomend")),void 0!=this.moveEndTargetFeature){this.moveEndListener=null;var c=this.moveEndTargetFeature,d=this.moveEndTargetLocation;this.isJITLayer(c.layer)?this.isLoaded(c)?this.queuePopupFunction(c,d):this.queueJIT(c,c.layer,c.attributes,d,"bottom-left"):this.queuePopupFunction(c,d)}},zoomComplete:function(a){},zoomTo:function(a,b){this.map.moveTo(null,a,{dragging:void 0,forceZoomChange:void 0,silent:b})},focusOnItem:function(a,b,c,d){this.moveEndListener=null,"OpenLayers.LonLat"==b.CLASS_NAME?this.focusOnLocation(b,c,d):this.focusOnLocation(b.getBounds().getCenterLonLat(),c,d)},focusOnLocation:function(a,b,c){this.atCenter(a)?void 0!=b&&b!=this.map.getZoom()&&this.map.isValidZoomLevel(b)&&(this.zoomTo(b,!0),this.map.events.triggerEvent("zoomend")):this.closeToCenter(a)?void 0!=b&&b!=this.map.getZoom()&&this.map.isValidZoomLevel(b)&&this.map.moveTo(a,b,{dragging:void 0,forceZoomChange:void 0,silent:!0}):this.animate?void 0!=b&&b!=this.map.getZoom()&&this.map.isValidZoomLevel(b)?(b>this.map.getZoom()?(this.zoomTo(b,!0),this.map.events.triggerEvent("zoomend")):b<this.map.getZoom()&&(this.zoomEndTargetLevel=b),this.map.panTo(a,this)):this.map.panTo(a,this):void 0!=b&&b!=this.map.getZoom()&&this.isValidZoomLevel(zoom)?this.map.moveTo(a,b,{dragging:void 0,forceZoomChange:void 0}):this.map.moveTo(a,null,{dragging:void 0,forceZoomChange:void 0})},atCenter:function(a){return a.equals(this.map.getCenter())},closeToCenter:function(a){var b=!1,c=void 0,d=this.map.getZoom();if("EPSG:900913"==this.map.getProjection()&&(c=.01/Math.pow(2,d)),void 0!=c){var e=this.map.getCenter(),f=Math.sqrt(Math.pow(a.lat-e.lat,2)+Math.pow(a.lon-e.lon,2));b=c>f}return b},unFocusOnItem:function(a){this.moveEndTargetFeature=void 0,this.moveEndTargetLocation=void 0,this.moveEndListener=null},unFocusAll:function(a){},initialize:function(a){var b={multiple:!1,clickout:!0,hover:!0};a=void 0==a?b:OpenLayers.Util.applyDefaults(a,b),OpenLayers.Control.prototype.initialize.apply(this,[a]),null===this.scope&&(this.scope=this)},panMapStart:function(){return!0},panMap:function(a){return!0},panMapDone:function(a){return!0},CLASS_NAME:"OpenLayers.Control.Focus"}),OpenLayers.Control.Link=OpenLayers.Class(OpenLayers.Control,{url:void 0,handler:void 0,initialize:function(a,b){this.url=a;var c={autoActivate:!0};b=void 0==b?c:OpenLayers.Util.applyDefaults(b,c),OpenLayers.Control.prototype.initialize.apply(this,[b]);var d={single:!0,"double":!1,pixelTolerance:0,stopSingle:!1,stopDouble:!1};this.handler=new OpenLayers.Handler.Click(this,{click:this.onClick},d)},activate:function(){return this.active||void 0!=this.handler&&this.handler.activate(),OpenLayers.Control.prototype.activate.apply(this,arguments)},deactivate:function(){return this.active&&void 0!=this.handler&&this.handler.deactivate(),OpenLayers.Control.prototype.deactivate.apply(this,arguments)},setMap:function(a){OpenLayers.Control.prototype.setMap.apply(this,arguments),void 0!=this.handler&&this.handler.setMap(a)},onClick:function(){this.active&&void 0!=this.url&&(window.top.location.href=this.url)},CLASS_NAME:"OpenLayers.Control.Link"}),OpenLayers.Control.TimeSlider=OpenLayers.Class(OpenLayers.Control,{daysoftheweek:["Sunday","Monday","Tuesday","Wednesday","Thursday","Friday","Saturday"],monthsoftheyear:["January","February","March","April","May","June","July","August","September","October","November","December"],type:"single",mainDiv:void 0,middle:void 0,mainLabel:void 0,mainLabelSpan:void 0,slider:void 0,listener:void 0,prev:void 0,next:void 0,divTicks:void 0,divLabels:void 0,refreshDelay:2e3,refreshTimer:void 0,handleDelay:0,handleTimer:void 0,collapseDelay:2e3,collapseTimer:void 0,updateDelay:2e3,dateTicks:!0,dateLabels:!0,animate:!0,currentDate:void 0,currentDateRange:void 0,currentTime:void 0,currentTimeRange:void 0,value:void 0,values:void 0,minDate:void 0,minTime:void 0,maxDate:void 0,maxTime:void 0,days:void 0,expandedMaxWidth:800,collapsedMaxWidth:200,padding:20,layer:null,layers:null,chart:null,blackholeEvents:!0,isAnimated:function(){return this.animate},getMaxWidth:function(){return OpenLayers.Element.hasClass(this.mainDiv,"expanded")?this.expandedMaxWidth:this.collapsedMaxWidth},setLayer:function(a){var b=this.active;this.unselectAll(),this.deactivate(),this.layers&&(this.layer.destroy(),this.layers=null),this.initLayer(a),this.handlers.feature.layer=this.layer,b&&this.activate()},isSingle:function(){return"single"==this.type},isRange:function(){return"range"==this.type},copyDate:function(a){return new Date(a.getFullYear(),a.getMonth(),a.getDate())},formatCurrentDate:function(a){return this.formatDate(this.getCurrentDate(),a)},formatCurrentStartDate:function(a){return this.formatDate(this.getCurrentStartDate(),a)},formatCurrentEndDate:function(a){return this.formatDate(this.getCurrentEndDate(),a)},formatDate:function(a,b){return void 0==a?"":"label"==b?this.monthsoftheyear[a.getMonth()]+" "+a.getDate()+", "+a.getFullYear():"wfs"==b?a.getFullYear()+"-"+(a.getMonth()<9?"0"+(a.getMonth()+1):a.getMonth()+1)+"-"+(a.getDate()<10?"0"+a.getDate():a.getDate()):void 0},setCurrentDate:function(a,b){_setCurrentDate(a),b&&this._updateUI()},setCurrentDateRange:function(a,b,c){_setCurrentDateRange(a,b),c&&this._updateUI()},incrementDate:function(a){if(this.isSingle()){var b=this.getCurrentDate(),c=new Date(b.getFullYear(),b.getMonth(),b.getDate()+1);c.getTime()<=this.getMaxTime()&&(this._setCurrentDate(c),this.delayRefresh())}else if(this.isRange()){var d=this.getCurrentStartDate(),e=this.getCurrentEndDate(),f=new Date(d.getFullYear(),d.getMonth(),d.getDate()+1),g=new Date(e.getFullYear(),e.getMonth(),e.getDate()+1);g.getTime()<=this.getMaxTime()&&(this._setCurrentDateRange(f,g),this.delayRefresh())}a&&this._updateUI()},decrementDate:function(a){if(this.isSingle()){var b=this.getCurrentDate(),c=new Date(b.getFullYear(),b.getMonth(),b.getDate()-1);c.getTime()>=this.getMinTime()&&(this._setCurrentDate(c),this.delayRefresh())}else if(this.isRange()){var d=this.getCurrentStartDate(),e=this.getCurrentEndDate(),f=new Date(d.getFullYear(),d.getMonth(),d.getDate()-1),g=new Date(e.getFullYear(),e.getMonth(),e.getDate()-1);f.getTime()>=this.getMinTime()&&(this._setCurrentDateRange(f,g),this.delayRefresh())}a&&this._updateUI()},hasPrevious:function(){return this.isSingle()?this.getValue()>0:this.isRange()?this.getStartValue()>0:void 0},hasNext:function(){return this.isSingle()?this.getValue()<this.getDays()-1:this.isRange()?this.getEndValue()<this.getDays()-1:void 0},_setCurrentDate:function(a){a=this.boundDate(a),this.currentDate=a,this.currentTime=a.getTime(),this.value=Math.floor((this.currentTime-this.minTime)/864e5)},_setCurrentDateRange:function(a,b){a=this.boundDate(a),b=this.boundDate(b),this.currentDateRange=[a,b];var c=a.getTime(),d=b.getTime();this.currentTimeRange=[c,d];var e=Math.floor((this.currentTimeRange[0]-this.minTime)/864e5),f=Math.floor((this.currentTimeRange[1]-this.minTime)/864e5);this.values=[e,f]},_setCurrentStartDate:function(a){a=this.boundDate(a),this.currentDateRange[0]=a;var b=a.getTime();this.currentTimeRange[0]=b;var c=Math.floor((b-this.minTime)/864e5);this.values[0]=c},_setCurrentEndDate:function(a){a=this.boundDate(a),this.currentDateRange[1]=a;var b=a.getTime();this.currentTimeRange[1]=b;var c=Math.floor((b-this.minTime)/864e5);this.values[1]=c},boundDate:function(a){var b=void 0;return b=a.getTime()>this.getMaxTime()?this.copyDate(this.getMaxDate()):a.getTime()<this.getMinTime()?this.copyDate(this.getMinDate()):this.copyDate(a)},getCurrentDate:function(){return this.currentDate},getCurrentStartDate:function(){return void 0!=this.currentDateRange?this.currentDateRange[0]:void 0},getCurrentEndDate:function(){return void 0!=this.currentDateRange?this.currentDateRange[1]:void 0},getValue:function(){return this.value},getStartValue:function(){return this.values[0]},getEndValue:function(){return this.values[1]},getValues:function(){return this.values},getMinDate:function(){return this.minDate},getMinTime:function(){return this.minTime},getMaxDate:function(){return this.maxDate},getMaxTime:function(){return this.maxTime},getDays:function(){return this.days},getHandle:function(){return $(this.slider).data("slider").handle},getStartHandle:function(){return $($(this.slider).data("slider").handles.get(0))},getEndHandle:function(){return $($(this.slider).data("slider").handles.get(1))},getUpdateDelay:function(){return this.updateDelay()},setUpdateDelay:function(a){this.updateDelay=a},turnOffDateTicks:function(){this.dateTicks=!1,OpenLayers.Element.addClass(mainDiv,"noDateTicks")},turnOnDateTicks:function(){this.dateTicks=!0,OpenLayers.Element.removeClass(mainDiv,"noDateTicks")},turnOffDateLabels:function(){this.dateLabels=!1,OpenLayers.Element.addClass(mainDiv,"noDateLabels")},turnOnDateLabels:function(){this.dateLabels=!0,OpenLayers.Element.removeClass(mainDiv,"noDateLabels")},_updateUI:function(){this._updateTimeLabel(),this._updateSlider(),this.delayHandleUpdate()},_updateTimeLabel:function(){$(this.mainLabelSpan).html(this.buildTimeLabel())},buildTimeLabel:function(){var a="";return this.isSingle()?a="Timeline<br>"+this.formatCurrentDate("label"):this.isRange()&&(a="Timeline<br>"+this.formatCurrentStartDate("label")+" -<br> "+this.formatCurrentEndDate("label")),a},_updateSlider:function(){this.isSingle()?$(this.slider).slider("option","value",this.getValue()):this.isRange()&&$(this.slider).slider("option","values",this.getValues()),void 0!=this.listener&&this.listener()},setDateRange:function(a,b){this.minDate=a,this.minTime=a.getTime(),this.maxDate=b,this.maxTime=b.getTime(),this.days=Math.floor((this.maxTime-this.minTime)/864e5+1)},stopHandleUpdate:function(){void 0!=this.handleTimer&&(clearTimeout(this.handleTimer),this.handleTimer=void 0)},delayHandleUpdate:function(){var a=this;a.stopHandleUpdate(),a.handleTimer=setTimeout(function(){a.updateSliderHandles()},a.handleDelay)},updateSliderHandles:function(){if(this.isSingle()){var a=this.getHandle(),b=a.data("label");$(b).css("left",a.css("left")),$("span",b).html(this.formatCurrentDate("label"))}else if(this.isRange()){var c=this.getStartHandle(),d=c.data("label"),e=this.getEndHandle(),f=e.data("label");$(d).css("left",c.css("left")),$("span",d).html(this.formatCurrentStartDate("label")),$(f).css("left",e.css("left")),$("span",f).html(this.formatCurrentEndDate("label"))}},stopCollapse:function(){void 0!=this.collapseTimer&&(clearTimeout(this.collapseTimer),this.collapseTimer=void 0)},delayCollapse:function(){var a=this;a.stopCollapse(),a.collapseTimer=setTimeout(function(){a.collapse()},a.collapseDelay)},collapse:function(){if(this.collapseTimer=void 0,OpenLayers.Element.hasClass(this.mainDiv,"expanded")&&OpenLayers.Element.removeClass(this.mainDiv,"expanded"),$(this.mainDiv).stop(!0,!1),this.isAnimated()){var a=this.map,b=Math.min(a.getCurrentSize().w-this.padding,this.getMaxWidth()),c=-1*(b/2)-this.padding/4;$(this.mainDiv).animate({width:b,"margin-left":c})}else this._resizeSlider()},expand:function(){if(this.stopCollapse(),OpenLayers.Element.hasClass(this.mainDiv,"expanded")||OpenLayers.Element.addClass(this.mainDiv,"expanded"),$(this.mainDiv).stop(!0,!1),this.isAnimated()){var a=this.map,b=Math.min(a.getCurrentSize().w-this.padding,this.getMaxWidth()),c=-1*(b/2)-this.padding/4;$(this.mainDiv).animate({width:b,"margin-left":c})}else this._resizeSlider()},stopRefresh:function(){void 0!=this.refreshTimer&&(clearTimeout(this.refreshTimer),this.refreshTimer=void 0)},delayRefresh:function(){var a=this;a.stopRefresh(),a.refreshTimer=setTimeout(function(){a.refresh()},a.refreshDelay)},refresh:function(){if(this.refreshTimer=void 0,void 0!=this.chart&&(this.isSingle()?this.chart._setCurrentDate(this.getCurrentDate()):this.isRange()&&this.chart._setCurrentDateRange(this.currentDateRange[0],this.currentDate[1])),void 0!=this.layer)this._refreshLayer(this.layer);else for(var a=0;a<this.layers.length;a++)this._refreshLayer(this.layers[a])},_refreshLayer:function(a){this.isSingle()?a.refreshTimeFilter({date:this.formatCurrentDate("wfs")}):this.isRange()&&a.refreshTimeFilter({start:this.formatCurrentStartDate("wfs"),end:this.formatCurrentEndDate("wfs")})},initialize:function(a,b){OpenLayers.Control.prototype.initialize.apply(this,[b]),OpenLayers.Util.isArray(a)?this.layers=a:this.layer=a,this.initializeDateRange(),this.initializeCurrentDate()},initializeDateRange:function(){var a=this.getMinDate(),b=this.getMaxDate();if(void 0==a||void 0==b){var c=new Date,d=new Date(c.getFullYear(),c.getMonth(),c.getDate());a=new Date(d.getFullYear(),d.getMonth(),d.getDate()-7),b=new Date(d.getFullYear(),d.getMonth(),d.getDate())}this.setDateRange(a,b)},initializeCurrentDate:function(){if(this.isSingle()){var a=this.getCurrentDate();void 0==a&&(a=this.copyDate(this.maxDate)),this._setCurrentDate(a)}else if(this.isRange()){var b=this.getCurrentStartDate(),c=this.getCurrentEndDate();(void 0==b||void 0==c)&&(b=new Date(this.maxDate.getFullYear(),this.maxDate.getMonth(),this.maxDate.getDate()-7),c=this.copyDate(this.maxDate)),this._setCurrentDateRange(b,c)}},draw:function(){var a=OpenLayers.Control.prototype.draw.apply(this);this.isSingle()?OpenLayers.Element.addClass(a,"single"):this.isRange()&&OpenLayers.Element.addClass(a,"range"),this.isAnimated()&&OpenLayers.Element.addClass(a,"animate"),this.dateTicks||OpenLayers.Element.addClass(a,"noDateTicks"),this.dateLabels||OpenLayers.Element.addClass(a,"noDateLabels");var b=void 0,c=void 0,d=document.createElement("div");d.className="olControlTimeSliderMiddle olControlMiddle";var e=document.createElement("div");e.className="olControlTimeSliderLabel",$(e).data("olControlTimeSlider",this);var f=document.createElement("span");f.innerHTML=this.buildTimeLabel(),e.appendChild(f),d.appendChild(e);var g=document.createElement("div");g.className="olControlTimeSliderContainer";var h=this.createPreviousButton();g.appendChild(h);var i=this.createSlider();g.appendChild(i);var j=this.createTicksAndLabels(this.dateTicks,this.dateLabels);g.appendChild(j.dateTicks),g.appendChild(j.dateLabels),this.isSingle()?(b=this.createHandleLabel(this.getCurrentDate(),$(i).data("slider").handle),i.appendChild(b)):this.isRange()&&($($(i).data("slider").handles.get(0)).data("date","start"),$($(i).data("slider").handles.get(1)).data("date","end"),c=this.createHandleLabels(i),i.appendChild(c[0]),i.appendChild(c[1]));var k=this.createNextButton();g.appendChild(k),d.appendChild(g),a.appendChild(d),this.mainDiv=a,this.middle=d,this.mainLabel=e,this.mainLabelSpan=f,this.sliderContainer=g,this.prev=h,this.slider=i,this.next=k,this.divDateTicks=j.dateTicks,this.divDateLabels=j.dateLabels,this.isSingle()?this.handleLabel=b:this.isRange()&&(this.handleLabels=c),this.delayHandleUpdate(),$(a).data("olControlTimeSlider",this),$(a).hover(this.onMouseEnter,this.onMouseLeave),$(e).click(function(){var a=$(this).data("olControlTimeSlider");a.onMainLabelClick.apply(a)});var l=this.map.events;return l.registerPriority("click",this,this.onMapClick),$(a).on("click dblclick",null,this,this.blackhole),a},passthrough:function(a){return!1},blackhole:function(a){a.stopPropagation()},onMainLabelClick:function(){this.isAnimated()||this.expand()},onMapClick:function(){this.isAnimated()||this.collapse()},onPrevious:function(){this.hasPrevious()&&this.decrementDate(!0)},onNext:function(){this.hasNext()&&this.incrementDate(!0)},onSlide:function(a,b){if(this.isSingle()){var c=this.getMinDate(),d=new Date(c.getFullYear(),c.getMonth(),c.getDate()+b);this._setCurrentDate(d)}else if(this.isRange()){var c=this.getMinDate(),d=new Date(c.getFullYear(),c.getMonth(),c.getDate()+b);"start"==a.data("date")?this._setCurrentStartDate(d):"end"==a.data("date")&&this._setCurrentEndDate(d)}this.delayRefresh(),this._updateTimeLabel(),this.delayHandleUpdate()},onMapResize:function(){this._resizeSlider(),this._resizeHandles()},_resizeSlider:function(){var a=this.map,b=Math.min(a.getCurrentSize().w-this.padding,this.getMaxWidth()),c=""+(-1*(b/2)-this.padding/4)+"px";$(this.mainDiv).css({width:b+"px","margin-left":c})},_resizeHandles:function(){var a=this.map.getCurrentSize().w,b=void 0;b=a>825?17:a>=465&&825>=a?13:11,this.isSingle()?this.getHandle().css("width",b+"px"):this.isRange()&&(this.getStartHandle().css("width",b+"px"),this.getEndHandle().css("width",b+"px"))},onMouseEnter:function(a){var b=$(this).data("olControlTimeSlider");b.isAnimated.apply(b)&&b.expand.apply(b)},onMouseLeave:function(a){var b=$(this).data("olControlTimeSlider");b.isAnimated.apply(b)&&b.delayCollapse.apply(b)},onMouseMove:function(a){var b=a.data;return b._mouseMoveDelegate(event),!1},onMouseUp:function(a){var b=a.data;return b._mouseUpDelegate(event),!0},createPreviousButton:function(){var a="olControlTimeSliderButton olControlTimeSliderPrevious ui-button ui-widget ui-state-default ui-corner-all ui-button-icon-only",b='<span class="ui-button-icon-primary ui-icon ui-icon-seek-start"></span>',c={},d=function(a){var b=$(this).data("olControlTimeSlider");return b.onPrevious.apply(b),a.stopPropagation(),!1};return this.createButton(a,b,c,d)},createNextButton:function(){var a="olControlTimeSliderButton olControlTimeSliderNext ui-button ui-widget ui-state-default ui-corner-all ui-button-icon-only",b='<span class="olControlTimeSliderNext ui-button-icon-primary ui-icon ui-icon-seek-end"></span>',c={},d=function(a){var b=$(this).data("olControlTimeSlider");return b.onNext.apply(b),a.stopPropagation(),!1};return this.createButton(a,b,c,d)},createButton:function(a,b,c,d){var e=$(document.createElement("button"));return e.attr("type","button"),e.addClass(a),e.html(b),e.css(c),e.data("olControlTimeSlider",this),e.hover(function(){$(this).addClass("ui-state-hover")},function(){$(this).removeClass("ui-state-hover")}),e.click(d),e.get(0)},createSlider:function(){var a=this,b=document.createElement("div");return b.className="olControlTimeSliderSlider",$(b).data("olControlTimeSlider",this),this.isSingle()?($(b).slider({min:0,max:this.getDays()-1,range:!1,value:this.getValue(),step:1,start:function(b,c){a.map.events.bypass=!0},stop:function(b,c){a.map.events.bypass=!1},slide:function(a,b){var c=$(this).data("olControlTimeSlider");return c.onSlide.apply(c,[$(b.handle),b.value]),!0}}),$(b).css("z-index","20")):this.isRange()&&$(b).slider({min:0,max:this.getDays()-1,range:!0,values:this.getValues(),step:1,start:function(b,c){a.map.events.bypass=!0},stop:function(b,c){a.map.events.bypass=!1},slide:function(a,b){var c=$(this).data("olControlTimeSlider");c.onSlide.apply(c,[$(b.handle),b.value])}}),b},createTicksAndLabels:function(a,b){var c=document.createElement("div");c.className="olControlTimeSliderDateTicks";var d=document.createElement("div");d.className="olControlTimeSliderDateLabels";for(var e=this.getMinDate(),f=this.getDays(),g=0;f>g;g++){var h=Math.floor(f/365)+1,i=new Date(e.getFullYear(),e.getMonth(),e.getDate()+g),j=i.getMonth(),k=g/(f-1)*100;0==i.getMonth()&&1==i.getDate()?(c.appendChild(this.createDateTick("year",g,k)),d.appendChild(this.createDateLabel("year",g,i,k))):1==i.getDate()?(c.appendChild(this.createDateTick("month",g,k)),j%h==0&&d.appendChild(this.createDateLabel("month",g,i,k))):c.appendChild(this.createDateTick("day",g,k))}return{dateTicks:c,dateLabels:d}},createDateTick:function(a,b,c){var d=document.createElement("span");return"year"==a?d.className="olControlTimeSliderDateTick olControlTimeSliderYearTick":"month"==a?d.className="olControlTimeSliderDateTick olControlTimeSliderMonthTick":"day"==a&&(d.className="olControlTimeSliderDateTick olControlTimeSliderDayTick"),$(d).css({left:c+"%"}),$(d).data("day",b),d},createDateLabel:function(a,b,c,d){var e=document.createElement("div");return"year"==a?(e.className="olControlTimeSliderDateLabel olControlTimeSliderYearLabel",$(e).html("<span>"+c.getFullYear()+"</span>")):"month"==a&&(e.className="olControlTimeSliderDateLabel olControlTimeSliderMonthLabel",$(e).html("<span>"+this.monthsoftheyear[c.getMonth()]+"</span>")),$(e).css({left:d+"%"}),$(e).data("day",b),e},createHandleLabels:function(a){var b=this.createHandleLabel(this.getCurrentStartDate(),$(a).data("slider").handles.get(0)),c=this.createHandleLabel(this.getCurrentEndDate(),$(a).data("slider").handles.get(1)),d=[b,c];return d},createHandleLabel:function(a,b){var c=document.createElement("div");return c.className="olControlTimeSliderHandleLabel",$(c).html("<span>"+this.formatDate(a,"label")+"</span>"),$(b).data("label",$(c)),c},destroy:function(){this.sliderEvents.un({touchstart:this.zoomBarDown,touchmove:this.zoomBarDrag,touchend:this.zoomBarUp,mousedown:this.zoomBarDown,mousemove:this.zoomBarDrag,mouseup:this.zoomBarUp}),this.sliderEvents.destroy()},CLASS_NAME:"OpenLayers.Control.TimeSlider"}),OpenLayers.Control.Title=OpenLayers.Class(OpenLayers.Control,{name:void 0,url:void 0,mode:"hover",rounded:!1,mainDiv:void 0,container:void 0,initialize:function(a,b,c){OpenLayers.Control.prototype.initialize.apply(this,[c]),this.name=a,this.url=b},isHover:function(){return"hover"==this.mode},isFixed:function(){return"fixed"==this.mode},isRounded:function(){return 1==this.rounded},draw:function(){var a=OpenLayers.Control.prototype.draw.apply(this);this.isHover()?OpenLayers.Element.addClass(a,"hover"):this.isFixed()&&OpenLayers.Element.addClass(a,"fixed"),this.isRounded()&&OpenLayers.Element.addClass(a,"rounded"),this.container=document.createElement("div"),this.container.className="olControlTitleContainer";var b=document.createElement("div");b.className="olControlTitleBody";var c=document.createElement("span");return void 0!=this.name?void 0!=this.url?c.innerHTML='<a href="'+this.url+'">'+this.name+"</a>":c.innerHTML=this.name:c.innerHTML="No name specified",b.appendChild(c),this.container.appendChild(b),a.appendChild(this.container),this.mainDiv=a,$(a).on("click dblclick","a",this,this.onClick),a},setZIndex:function(a,b){this.container.style.zIndex=a+b},onMapResize:function(){},onClick:function(a){window.top.location.href=a.data.url},destroy:function(){},CLASS_NAME:"OpenLayers.Control.Title"}),OpenLayers.Format.AdvancedText=OpenLayers.Class(OpenLayers.Format.Text,{delimiter:"	",mapProjection:void 0,initialize:function(a){OpenLayers.Format.Text.prototype.initialize.apply(this,[a]),this.wgs84=new OpenLayers.Projection("EPSG:4326")},read:function(a){var b=[],c=a.split("\n");c=$.grep(c,function(a,b){return $.trim(a).length>0});for(var d=$.map(c[0].split(this.delimiter),function(a,b){return OpenLayers.String.trim(a)}),e=this.getColumnIndex(d,["latlon","latlong","lat_lon","lat long"]),f=this.getColumnIndex(d,["lonlat","longlat","long_lat","long lat"]),g=this.getColumnIndex(d,["lat","latitude","lat_dd","latitude_dd"]),h=this.getColumnIndex(d,["lon","long","longitude","lon_dd","long_dd","longitude_dd"]),i=this.getColumnIndex("y"),j=this.getColumnIndex("x"),k=1;k<c.length;k++){for(var l=c[k],m=$.map(l.split(this.delimiter),function(a,b){return OpenLayers.String.trim(a)}),n=this.buildGeometry(m[e],m[f],m[g],m[h],m[i],m[j]),o={},p=0;p<d.length;p++)o[""+d[p]]=m[p];if(void 0!=o&&void 0!=n){var q=new OpenLayers.Feature.Vector(n,o);b.push(q)}}return b},buildGeometry:function(a,b,c,d,e,f){var g=void 0;if(void 0!=a){var h=a.split(",");g=new OpenLayers.Geometry.Point(h[1],h[0]);
}else if(void 0!=b){var h=b.split(",");g=new OpenLayers.Geometry.Point(h[0],h[1])}return void 0!=c&&void 0!=d&&"-"!=c&&"-"!=d?g=new OpenLayers.Geometry.Point(d,c):void 0!=e&&void 0!=f&&"-"!=e&&"-"!=f&&(g=new OpenLayers.Geometry.Point(parseInt(e,10),parseInt(f,10)),void 0!=this.sourceProjection&&g.transform(this.sourceProjection,this.mapProjection)),g},getColumnIndex:function(a,b){var c=-1,d=void 0;if(CyberGIS.isString(b)?d=[b]:CyberGIS.isArray(b)&&(d=b),void 0!=d)for(var e=0;e<d.length;e++){for(var f=d[e],g=0;g<a.length;g++)if(a[g].toLowerCase()==f.toLowerCase()){c=g;break}if(-1!=c)break}return c},CLASS_NAME:"OpenLayers.Format.AdvancedText"}),OpenLayers.Format.SOAP=OpenLayers.Class(OpenLayers.Format.Text,{delimiter:"	",mapProjection:void 0,initialize:function(a){OpenLayers.Format.Text.prototype.initialize.apply(this,[a]),this.wgs84=new OpenLayers.Projection("EPSG:4326")},read:function(a,b){var c=[],d=a.substring(a.indexOf("<rs:data "),a.indexOf("</rs:data>")+"</rs:data>".length),e=d.replace(new RegExp("[\\n\\t\\r]","gi"),""),f=parseInt(e.replace(new RegExp('[<](rs[:]data)(?:\\s+)ItemCount[=]"(\\d+)"[>](.*?)(</\\1>)',"gi"),"$2"));if(f>0)for(var g=a.match(new RegExp("[<](z[:]row)(?:\\s+)(.+?)[/][>]","gi")),h=0;h<g.length;h++){for(var i=g[h],j=this.coalesceAttributesFromRow(i,["latlon","latlong","lat_lon","lat long"]),k=this.coalesceAttributesFromRow(i,["lonlat","longlat","long_lat","long lat"]),l=this.coalesceAttributesFromRow(i,["lat","latitude","lat_dd","latitude_dd"]),m=this.coalesceAttributesFromRow(i,["lon","long","longitude","lon_dd","long_dd","longitude_dd"]),n=this.coalesceAttributesFromRow(i,["yx","y_x","y x"]),o=this.coalesceAttributesFromRow(i,["xy","x_y","x y"]),p=this.extractAttributeFromRow(i,"y"),q=this.extractAttributeFromRow(i,"x"),r=this.buildGeometry(j,k,l,m,n,o,p,q),s={id:h},t=0;t<b.length;t++){var u=b[t];s[""+u]=this.extractAttributeFromRow(i,u)}if(void 0!=s&&void 0!=r){var v=new OpenLayers.Feature.Vector(r,s);c.push(v)}}return c},coalesceAttributesFromRow:function(a,b){for(var c=void 0,d=0;d<b.length;d++){var e=this.extractAttributeFromRow(a,b[d]);if(void 0!=e){c=e;break}}return c},extractAttributeFromRow:function(a,b){var c=b.replace(" ","_x0020_").replace("(","_x0028_").replace(")","_x0029_").replace("-","_x002d_").substring(0,32);return a.match(new RegExp(" ows_"+c+"=","gi"))?a.replace(new RegExp("(?:.+)(?:\\s+)ows_"+c+"=['](.+?)['](?:\\s+)(?:.+)","gi"),"$1"):void 0},buildGeometry:function(a,b,c,d,e,f,g,h){var i=void 0;if(void 0!=a){var j=a.split(",");i=new OpenLayers.Geometry.Point(j[1],j[0])}else if(void 0!=b){var j=b.split(",");i=new OpenLayers.Geometry.Point(j[0],j[1])}if(void 0!=c&&void 0!=d&&"-"!=c&&"-"!=d)i=new OpenLayers.Geometry.Point(d,c);else if(void 0!=e){var j=a.split(",");i=new OpenLayers.Geometry.Point(j[1],j[0]),void 0!=this.sourceProjection&&i.transform(this.sourceProjection,this.mapProjection)}else if(void 0!=f){var j=a.split(",");i=new OpenLayers.Geometry.Point(j[0],j[1]),void 0!=this.sourceProjection&&i.transform(this.sourceProjection,this.mapProjection)}else void 0!=g&&void 0!=h&&"-"!=g&&"-"!=h&&(i=new OpenLayers.Geometry.Point(parseInt(g,10),parseInt(h,10)),void 0!=this.sourceProjection&&i.transform(this.sourceProjection,this.mapProjection));return i},getColumnIndex:function(a,b){var c=-1,d=void 0;if(CyberGIS.isString(b)?d=[b]:CyberGIS.isArray(b)&&(d=b),void 0!=d)for(var e=0;e<d.length;e++){for(var f=d[e],g=0;g<a.length;g++)if(a[g].toLowerCase()==f.toLowerCase()){c=g;break}if(-1!=c)break}return c},CLASS_NAME:"OpenLayers.Format.SOAP"}),OpenLayers.Layer.HIUTileCache=OpenLayers.Class(OpenLayers.Layer.TMS,{initialize:function(a,b){var c;b=OpenLayers.Util.extend({type:"png",units:"m",projection:"EPSG:900913",displayOutsideMaxExtent:!0,wrapDateLine:!0,buffer:0,isBaseLayer:!0,maxExtent:new OpenLayers.Bounds(-20037508.34,-20037508.34,20037508.34,20037508.34)},b),c=[a,["http://hiu-maps.net/hot/"],b],OpenLayers.Layer.TMS.prototype.initialize.apply(this,c)},CLASS_NAME:"OpenLayers.Layer.HIUTileCache"}),OpenLayers.Layer.HIUTileCache2=OpenLayers.Class(OpenLayers.Layer.TMS,{initialize:function(a,b,c){var d;c=OpenLayers.Util.extend({type:"png",units:"m",projection:"EPSG:900913",displayOutsideMaxExtent:!1,wrapDateLine:!1,buffer:0,isBaseLayer:!1,maxExtent:new OpenLayers.Bounds(-20037508.34,-20037508.34,20037508.34,20037508.34)},c),d=[a,$.map(b.split(","),function(a){return $.trim(a)}),c],OpenLayers.Layer.TMS.prototype.initialize.apply(this,d)},CLASS_NAME:"OpenLayers.Layer.HIUTileCache2"});var MAPBOX_LOGO="http://js.mapbox.com/img/mapbox.png";OpenLayers.Layer.MapBox=OpenLayers.Class(OpenLayers.Layer.TMS,{initialize:function(a,b){var c;b=OpenLayers.Util.extend({attribution:"<a style='background: url("+MAPBOX_LOGO+"); height: 22px; width: 80px; float: left; clear: left;margin-right: 10px;' href='http://mapbox.com'></a> <span style='vertical-align: middle;'>|</span> <a style='font-family: sans-serif; text-decoration: none; color: #263E55;vertical-align: middle;font-size: 90%;' href='http://mapbox.com/tos'>Terms of Service</a>",type:"png",units:"m",projection:"EPSG:900913",displayOutsideMaxExtent:!0,wrapDateLine:!0,buffer:0,isBaseLayer:!0,maxExtent:new OpenLayers.Bounds(-20037508.34,-20037508.34,20037508.34,20037508.34),serviceVersion:"v1"},b),b.osm&&(b.attribution="<a style='background: url("+MAPBOX_LOGO+"); height: 22px; width: 80px; float: left; clear: left;margin-right: 10px;' href='http://mapbox.com'></a> <span style='vertical-align: middle;'>|</span> <a style='font-family: sans-serif; text-decoration: none; color: #263E55;vertical-align: middle;font-size: 90%;' href='http://mapbox.com/tos'>Terms of Service</a> <span style='font-family: sans-serif; text-decoration: none; color: #263E55;vertical-align: middle;font-size: 90%;'>| Data &copy; OSM CCBYSA</span>");var d=1==b.ssl?"https":"http";c=[a,[d+"://a.tiles.mapbox.com/",d+"://b.tiles.mapbox.com/",d+"://c.tiles.mapbox.com/",d+"://d.tiles.mapbox.com/"],b],OpenLayers.Layer.TMS.prototype.initialize.apply(this,c)},CLASS_NAME:"OpenLayers.Layer.MapBox"}),OpenLayers.Layer.TimeVector=OpenLayers.Class(OpenLayers.Layer.Vector,{time_type:void 0,time_property:void 0,time_property_start:void 0,time_property_end:void 0,time_state:void 0,isDateObject:function(a){return"[object Date]"===Object.prototype.toString.call(a)},isDateNumbered_Full:function(a){var b=new RegExp("^\\d{8}$","gi");return b.test(a)},isDateNumbered_Short:function(a){var b=new RegExp("^\\d{6}$","gi");return b.test(a)},isDateSplit:function(a){var b=new RegExp("^\\d{2,4}[-]\\d{1,2}[-]\\d{1,2}$","gi");return b.test(a)},isDateSplit_Full:function(a){var b=new RegExp("^\\d{4}[-]\\d{2}[-]\\d{2}$","gi");return b.test(a)},isDateSplit_Short:function(a){var b=new RegExp("^\\d{2}[-]\\d{2}[-]\\d{2}$","gi");return b.test(a)},cleanDateString:function(a){var b="";if(this.isDateObject(a))b=a.getFullYear()+"-"+(a.getMonth()<9?"0"+(a.getMonth()+1):a.getMonth()+1)+"-"+(a.getDate()<10?"0"+a.getDate():a.getDate());else if(this.isDateNumbered_Full(a))b=a.substring(0,4)+"-"+a.substring(4,6)+"-"+a.substring(6);else if(this.isDateNumbered_Short(a)){var c=parseInt(a.substring(0,2),10);c=20>c?2e3+c:1900+c,b=c+"-"+a.substring(2,4)+"-"+a.substring(4)}else if(this.isDateSplit(a))if(this.isDateSplit_Full(a))b=a;else if(this.isDateSplit_Short(a)){var d=a.split(","),e=parseInt(d[0],10);e=20>e?2e3+e:1900+e;var f=parseInt(d[1],10),g=parseInt(d[2],10);b=e+"-"+(9>f?"0"+(f+1):f+1)+"-"+(10>g?"0"+g:g)}return b},getTimeType:function(){return this.time_type},isTime:function(){return void 0!=this.getTimeType()},isSingle:function(){return"single"==this.getTimeType()},isRange:function(){return"range"==this.getTimeType()},getTimeProperty:function(){return this.isSingle()?this.time_property:void 0},getTimeStartProperty:function(){return this.isRange()?this.time_property_start:void 0},getTimeEndProperty:function(){return this.isRange()?this.time_property_end:void 0},refreshTimeFilter:function(a){this.filter=this.getTimeFilter(a),this.refresh({force:!0})},getTimeFilter:function(a){var b=void 0;if(this.isTime()&&void 0!=a)if(void 0!=a.date){var c=this.cleanDateString(a.date);this.isSingle()?b=new OpenLayers.Filter.Comparison({type:OpenLayers.Filter.Comparison.EQUAL_TO,property:this.getTimeProperty(),value:c}):this.isRange()&&(b=new OpenLayers.Filter.Logical({type:OpenLayers.Filter.Logical.AND,filters:[new OpenLayers.Filter.Logical({type:OpenLayers.Filter.Logical.OR,filters:[new OpenLayers.Filter.Comparison({type:OpenLayers.Filter.Comparison.IS_NULL,property:this.getTimeStartProperty()}),new OpenLayers.Filter.Comparison({type:OpenLayers.Filter.Comparison.LESS_THAN_OR_EQUAL_TO,property:this.getTimeStartProperty(),value:c})]}),new OpenLayers.Filter.Logical({type:OpenLayers.Filter.Logical.OR,filters:[new OpenLayers.Filter.Comparison({type:OpenLayers.Filter.Comparison.IS_NULL,property:this.getTimeEndProperty()}),new OpenLayers.Filter.Comparison({type:OpenLayers.Filter.Comparison.GREATER_THAN_OR_EQUAL_TO,property:this.getTimeEndProperty(),value:c})]})]}))}else if(void 0!=a.start){var d=this.cleanDateString(a.start),e=this.cleanDateString(a.end);this.isSingle()?b=new OpenLayers.Filter.Comparison({type:OpenLayers.Filter.Comparison.BETWEEN,property:"entered",lowerBoundary:d,upperBoundary:e}):this.isRange()&&(b=new OpenLayers.Filter.Logical({type:OpenLayers.Filter.Logical.AND,filters:[new OpenLayers.Filter.Logical({type:OpenLayers.Filter.Logical.OR,filters:[new OpenLayers.Filter.Comparison({type:OpenLayers.Filter.Comparison.IS_NULL,property:this.getTimeStartProperty()}),new OpenLayers.Filter.Comparison({type:OpenLayers.Filter.Comparison.LESS_THAN_OR_EQUAL_TO,property:this.getTimeStartProperty(),value:e})]}),new OpenLayers.Filter.Logical({type:OpenLayers.Filter.Logical.OR,filters:[new OpenLayers.Filter.Comparison({type:OpenLayers.Filter.Comparison.IS_NULL,property:this.getTimeEndProperty()}),new OpenLayers.Filter.Comparison({type:OpenLayers.Filter.Comparison.GREATER_THAN_OR_EQUAL_TO,property:this.getTimeEndProperty(),value:d})]})]}))}return b},initialize:function(a,b){b.filter=void 0!=b.time_state?this.init_filter(b):void 0,OpenLayers.Layer.Vector.prototype.initialize.apply(this,arguments)},init_filter:function(a){var b=void 0,c=a.time_type;if(void 0!=c){var d=a.time_property,e=a.time_property_start,f=a.time_property_end,g=a.time_state;if(void 0!=g)if(void 0!=g.date){var h=this.cleanDateString(g.date);"single"==c?b=new OpenLayers.Filter.Comparison({type:OpenLayers.Filter.Comparison.EQUAL_TO,property:d,value:h}):"range"==c&&(b=new OpenLayers.Filter.Logical({type:OpenLayers.Filter.Logical.AND,filters:[new OpenLayers.Filter.Logical({type:OpenLayers.Filter.Logical.OR,filters:[new OpenLayers.Filter.Comparison({type:OpenLayers.Filter.Comparison.IS_NULL,property:e}),new OpenLayers.Filter.Comparison({type:OpenLayers.Filter.Comparison.LESS_THAN_OR_EQUAL_TO,property:e,value:h})]}),new OpenLayers.Filter.Logical({type:OpenLayers.Filter.Logical.OR,filters:[new OpenLayers.Filter.Comparison({type:OpenLayers.Filter.Comparison.IS_NULL,property:f}),new OpenLayers.Filter.Comparison({type:OpenLayers.Filter.Comparison.GREATER_THAN_OR_EQUAL_TO,property:f,value:h})]})]}))}else if(void 0!=g.start){var i=this.cleanDateString(g.start),j=this.cleanDateString(g.end);"single"==c?b=new OpenLayers.Filter.Comparison({type:OpenLayers.Filter.Comparison.BETWEEN,property:"entered",lowerBoundary:i,upperBoundary:j}):"range"==c&&(b=new OpenLayers.Filter.Logical({type:OpenLayers.Filter.Logical.AND,filters:[new OpenLayers.Filter.Logical({type:OpenLayers.Filter.Logical.OR,filters:[new OpenLayers.Filter.Comparison({type:OpenLayers.Filter.Comparison.IS_NULL,property:e}),new OpenLayers.Filter.Comparison({type:OpenLayers.Filter.Comparison.LESS_THAN_OR_EQUAL_TO,property:e,value:j})]}),new OpenLayers.Filter.Logical({type:OpenLayers.Filter.Logical.OR,filters:[new OpenLayers.Filter.Comparison({type:OpenLayers.Filter.Comparison.IS_NULL,property:f}),new OpenLayers.Filter.Comparison({type:OpenLayers.Filter.Comparison.GREATER_THAN_OR_EQUAL_TO,property:f,value:i})]})]}))}}return b},CLASS_NAME:"OpenLayers.Layer.TimeVector"}),OpenLayers.Protocol.SOAP=OpenLayers.Class(OpenLayers.Protocol.HTTP,{list:void 0,columns:void 0,initialize:function(a){OpenLayers.Protocol.HTTP.prototype.initialize.apply(this,[a])},buildEnvelope:function(a,b,c){var d="";return d+='<soap:Envelope xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" xmlns:xsd="http://www.w3.org/2001/XMLSchema" xmlns:soap="http://schemas.xmlsoap.org/soap/envelope/">',d+="<soap:Body>",d+='<GetListItems xmlns="http://schemas.microsoft.com/sharepoint/soap/">',d+="<listName>"+a+"</listName>",d+="<rowLimit>1000</rowLimit>",void 0!=b&&(d+="<viewFields><ViewFields>",$.each(b,function(a,b){d+='<FieldRef Name="'+b+'"/>'}),d+="</ViewFields></viewFields>"),void 0!=c&&(d+="<query>"+c+"</query>"),d+="<queryOptions><QueryOptions><IncludeAttachmentUrls>TRUE</IncludeAttachmentUrls></QueryOptions></queryOptions>",d+="</GetListItems>",d+="</soap:Body>",d+="</soap:Envelope>"},parseFeatures:function(a){return this.format.read(a.responseText,this.columns)},read:function(a){OpenLayers.Protocol.prototype.read.apply(this,arguments),a=OpenLayers.Util.extend({},a),OpenLayers.Util.applyDefaults(a,this.options||{});var b=new OpenLayers.Protocol.Response({requestType:"read"});a.headers={Accept:"application/xml, text/xml, */*, q=0.01","Content-Type":'text/xml; charset="UTF-8"'};var c=this.buildEnvelope(this.list,this.columns,void 0);return b.priv=OpenLayers.Request.POST({authenticated:1==a.authenticated,url:a.url,callback:this.createCallback(this.handleRead,b,a),params:a.params,headers:a.headers,data:c}),b},CLASS_NAME:"OpenLayers.Protocol.SOAP"}),OpenLayers.Strategy.JIT=OpenLayers.Class(OpenLayers.Strategy.Fixed,{regex_field:"^(\\${)(\\w+)(})$",regex_bbox:"^(\\s*)([-+]?\\d*[.]?\\d*)(\\s*)[,](\\s*)([-+]?\\d*[.]?\\d*)(\\s*)[,](\\s*)([-+]?\\d*[.]?\\d*)(\\s*)[,](\\s*)([-+]?\\d*[.]?\\d*)(\\s*)$",grep:void 0,jobs:void 0,listeners:[],hideEmpty:!0,allFeatures:void 0,validFeatures:void 0,activeFeatures:void 0,currentExtent:void 0,initialize:function(a,b,c){OpenLayers.Strategy.Fixed.prototype.initialize.apply(this,[c]),OpenLayers.Util.isArray(a)&&this.setJobs(a),this.setGrep(b)},setJobs:function(a){this.jobs=a;for(var b=0;b<this.jobs.length;b++){var c=this.jobs[b];c.id=c.id||b}},setGrep:function(a){this.grep=a},getJob:function(a){var b=void 0;return void 0!=this.jobs&&(b=this.jobs[a]),b},getNumberOfJobs:function(){var a=0;return void 0!=this.jobs&&(a=this.jobs.length),a},merge:function(a,b){var c=this.layer;c.destroyFeatures();var d=b.features;if(d&&d.length>0){if(!a.equals(c.projection))for(var e,f=0,g=d.length;g>f;++f)e=d[f].geometry,e&&e.transform(c.projection,a);this.allFeatures=d}else this.allFeatures=[];c.events.triggerEvent("loadend",{response:b})},initJobs:function(){for(var a=!1,b=0;b<this.jobs.length;b++){var c=this.jobs[b];if(void 0!=c.refresh&&void 0!=c.refresh.init&&1==c.refresh.init){a=!0;break}}a&&this.layer.events.on({loadend:function(a){var b=this;if(void 0!=b.options.jit){var c=b.strategies[0];c.onLoadEnd.apply(c)}}})},onLoadEnd:function(){this.currentExtent=this.getCurrentExtent(),this.validFeatures=this.grepFeatures(this.allFeatures);for(var a=0;a<this.jobs.length;a++){var b=this.jobs[a],c=!1;if(void 0!=b.refresh&&void 0!=b.refresh.init&&(c=1==b.refresh.init),c)if("simple"==b.type)this.runTasks(b);else if("advanced"==b.type&&void 0!=b.remote&&void 0!=b.remote.join)if(void 0!=b.remote.source){var d=b.remote.source,e=b.remote.join.type,f=b.remote.join.left,g=b.remote.join.include;if("single"==e)void 0!=d&&void 0!=e&&void 0!=f&&void 0!=g&&this.jit_source(b,d,e,void 0,f,g,void 0);else if("left"==e){var h=b.destination||"jit";void 0!=d&&void 0!=e&&void 0!=f&&void 0!=g&&this.jit_source(b,d,e,void 0,f,g,h)}else if("pcode"==e){var h=b.destination||"jit",i=b.remote.join.level;void 0!=d&&void 0!=e&&void 0!=i&&void 0!=f&&void 0!=g&&this.jit_source(b,d,e,i,f,g,h)}}else if(void 0!=b.remote.file){var j=b.remote.file.url,k=b.remote.file.delimiter;if(void 0!=j&&void 0!=k){var l=this.layer,m=this;this.listeners.push({url:j,context:this,job:b}),$.ajax({url:j,type:"GET",contentType:'application/json; charset="utf-8"',beforeSend:hiu.beforeSend,complete:function(a,b){var c=l.options.jit;void 0!=c&&(m.jit_response.apply(m,[j,a.responseText]),l.redraw())}})}}}},grepFeatures:function(a){if(void 0!=this.grep){var b=this;return $.grep(a,function(a){return b.testFeature.apply(b,[a,a.attributes,b.grep])})}return a},getCurrentExtent:function(){var a=void 0,b=this.layer.map,c=b.getCachedCenter(),d=b.getResolution();if(null!=c&&null!=d){var e=b.size.w*d/2,f=b.size.h*d/2;a=new OpenLayers.Bounds(c.lon-e,c.lat-f,c.lon+e,c.lat+f)}return a},runJob:function(a){var b=this.getJob(a);void 0!=b&&"basic"==b.type&&this.runTasks(b)},runTasks:function(a){if(void 0!=a.tasks)for(var b=0;b<this.validFeatures.length;b++){for(var c=this.validFeatures[b],d=0;d<a.tasks.length;d++){var e=a.tasks[d];this.calc(e,c,void 0)}this.setCompiled(c,a.id,"success")}if("simple"==a.type)if(void 0!=a.grep){var f=this;this.activeFeatures=$.grep(this.validFeatures,function(b,c){return f.testFeature(b,b.attributes,a.grep)})}else this.activeFeatures=this.validFeatures;else if("advanced"==a.type)if(void 0!=a.grep){var f=this;this.activeFeatures=$.grep(this.validFeatures,function(b,c){return f.testFeature(b,b.attributes,a.grep)}),this.hideEmpty&&(this.activeFeatures=$.grep(this.activeFeatures,function(a,b){return a.attributes.jit.length>0}))}else this.hideEmpty?this.activeFeatures=$.grep(this.validFeatures,function(a,b){return a.attributes.jit.length>0}):this.activeFeatures=this.validFeatures;this.layer.removeAllFeatures({silent:!0}),this.layer.addFeatures(this.activeFeatures),this.layer.redraw()},jit_response:function(a,b){for(var c=[],d=0;d<this.listeners.length;d++){var e=this.listeners[d];if(e.url==a){var f=e.job;if(void 0!=f.remote&&void 0!=f.remote.join&&void 0!=f.remote.file){var g=f.remote.join.type;if("left"==g||"pcode"==g){var h=f.remote.join.left,i=f.remote.join.right,j=f.remote.file.delimiter;if(void 0!=h&&void 0!=i&&void 0!=j){var k=b.split("\n");if(k=$.grep(k,function(a,b){return $.trim(a).length>0}),k.length>1)if("left"==g)for(var l=0;l<this.validFeatures.length;l++){var m=this.validFeatures[l];this.jit_feature(f,m,k,i,m.attributes[""+h],j,g,void 0)}else if("pcode"==g)for(var n=f.remote.join.level,l=0;l<this.validFeatures.length;l++){var m=this.validFeatures[l];this.jit_feature(f,m,k,i,m.attributes[""+h],j,g,n)}this.activeFeatures=$.grep(this.validFeatures,function(a,b){return void 0==a.attributes.jit?!1:a.attributes.jit.length>0}),this.layer.removevalidFeatures({silent:!0}),this.layer.addFeatures(this.activeFeatures),this.layer.redraw()}}}}else c.push(e)}this.listeners=c},jit_feature:function(a,b,c,d,e,f,g,h){if(!this.isFeatureCompiled(b,a.id)){var i=$.map(c[0].split(f),function(a,b){return OpenLayers.String.trim(a)}),j=this.getColumnIndex(i,d);if(-1!=j){for(var k=[],l=1;l<c.length;l++){var m=c[l],n=$.map(m.split(f),function(a,b){return OpenLayers.String.trim(a)});if("left"==g){if(void 0!=n[j]&&n[j].toLowerCase()==e.toLowerCase()){for(var o={},p=0;p<i.length;p++)o[""+i[p]]=n[p];k.push(o)}}else if("pcode"==g&&void 0!=n[j]&&OpenLayers.String.startsWith(n[j].toLowerCase(),e.toLowerCase())){for(var o={},p=0;p<i.length;p++)o[""+i[p]]=n[p];k.push(o)}}if(b.attributes.jit=k,void 0!=a.tasks)for(var l=0;l<a.tasks.length;l++)this.calc(a.tasks[l],b,k)}this.setCompiled(b,a.id,"success")}},jit_source:function(a,b,c,d,e,f,g){if(void 0!=c){var h=hiu.client.getDataSource.apply(hiu.client,[b]);if(void 0!=h){if("single"==c){for(var i=0;i<this.validFeatures.length;i++){var j=this.validFeatures[i],k=j.attributes[""+e],l=h.getValue(k);if(j.attributes[""+b]=l,j.attributes=OpenLayers.Util.applyDefaults(OpenLayers.Util.extend({},j.attributes),l),void 0!=a.tasks)for(var m=0;m<a.tasks.length;m++)this.calc(a.tasks[m],j,l);this.setCompiled(j,a.id,"success")}"all"==f?this.activeFeatures=this.validFeatures:this.activeFeatures=$.grep(this.validFeatures,function(a,c){return void 0!=a.attributes[""+b]})}else if("left"==c)if("all"==f)for(var i=0;i<this.validFeatures.length;i++){var j=this.validFeatures[i],k=j.attributes[""+e],l=[],n=h.getValue(k);if(void 0!=n)for(var m=0;m<n.length;m++)l.push(n[m]);if(j.attributes[""+g]=l,void 0!=a.tasks)for(var m=0;m<a.tasks.length;m++)this.calc(a.tasks[m],j,l);this.setCompiled(j,a.id,"success")}else this.activeFeatures=$.grep(this.validFeatures,function(a,b){return void 0==a.attributes[""+g]?!1:a.attributes[""+g].length>0});else if("pcode"==c){for(var i=0;i<this.validFeatures.length;i++){for(var j=this.validFeatures[i],k=j.attributes[""+e],l=[],n=h.getValues(k,!0,d),m=0;m<n.length;m++)l.push(n[m]);if(j.attributes[""+g]=l,void 0!=a.tasks)for(var m=0;m<a.tasks.length;m++)this.calc(a.tasks[m],j,l);this.setCompiled(j,a.id,"success")}"all"==f?this.activeFeatures=this.validFeatures:this.activeFeatures=$.grep(this.validFeatures,function(a,b){return void 0==a.attributes[""+g]?!1:a.attributes[""+g].length>0})}}else for(var i=0;i<this.validFeatures.length;i++)this.setCompiled(this.validFeatures[i],a.id,"SOURCE UNAVAILABLE")}this.layer.removeAllFeatures({silent:!0}),this.layer.addFeatures(this.activeFeatures),this.layer.redraw()},isFeatureCompiled:function(a,b){return 1==CyberGIS.getJSON(["jit","compiled",""+b],a.attributes)},getColumnIndex:function(a,b){for(var c=-1,d=0;d<a.length;d++)if(a[d].toLowerCase()==b.toLowerCase()){c=d;break}return c},setCompiled:function(a,b,c){void 0==a.attributes.jit&&(a.attributes.jit={compiled:{},status:{}}),a.attributes.jit.compiled[""+b]=!0,a.attributes.jit.status[""+b]=c},calc:function(a,b,c){"copy"==a.op?this.calc_copy(b,a.output,a.input,a.where):"parse"==a.op?this.calc_parse(b,a.output,a.input,a.type):"concat"==a.op?this.calc_concat(b,a.output,a.input,a.where):"split"==a.op?this.calc_split(b,a.output,a.input,a.delimiter,a.where):"join"==a.op?this.calc_join(b,a.output,a.input,a.delimiter,a.where):"grep"==a.op?this.calc_grep(b,a.output,a.input,a.values,a.keep,a.where):"count"==a.op?this.calc_count(b,c,a.output,a.where):"sum"==a.op?this.calc_sum(b,c,a.output,a.input):"min"==a.op?this.calc_min(b,c,a.output,a.input):"max"==a.op?this.calc_max(b,c,a.output,a.input):"avg"==a.op?this.calc_avg(b,c,a.output,a.input):"strip_fields"==a.op?this.calc_strip_fields(b,a.fields,a.characters):"strip_array"==a.op&&this.calc_strip_array(b,c,a.array_input,a.array_output,a.fields,a.field_input,a.field_output,a.characters)},calc_parse:function(a,b,c,d){if(CyberGIS.isString(d)&&CyberGIS.isString(b)&&CyberGIS.isString(c)){var e=a.attributes,f=e[""+c];CyberGIS.isString(f)&&("int"==d||"integer"==d?e[""+b]=parseInt(f,10):("float"==d||"double"==d)&&(e[""+b]=parseFloat(f)))}},calc_copy:function(a,b,c,d){if(this.testFeature(a,a.attributes,d)){var e=void 0;if(CyberGIS.isString(c))if(CyberGIS.isField(c)){var f=CyberGIS.extractField(c);e=void 0!=f?this.attr_s(f,a.attributes):u}else e=oInput;else e=this.attr(c,a.attributes);a.attributes[""+b]=e}},calc_concat:function(a,b,c,d){if(this.testFeature(a,a.attributes,d)){for(var e="",f=0;f<c.length;f++){var g=c[f];if(CyberGIS.isString(g))if(CyberGIS.isField(g)){var h=CyberGIS.extractField(g);e+=void 0!=h?this.attr_s(h,a.attributes):""}else e+=g;else e+=this.attr(g,a.attributes)}a.attributes[""+b]=e}},calc_split:function(a,b,c,d,e){if(this.testFeature(a,a.attributes,e)&&CyberGIS.isString(d)&&CyberGIS.isString(b)&&CyberGIS.isString(c)){var f=a.attributes;f[""+b]=CyberGIS.split(f[""+c],d)}},calc_join:function(a,b,c,d,e){if(this.testFeature(a,a.attributes,e)&&CyberGIS.isString(d)&&CyberGIS.isString(b)&&CyberGIS.isString(c)){var f=a.attributes;f[""+b]=CyberGIS.join(f[""+c],d)}},calc_grep:function(a,b,c,d,e,f){this.testFeature(a,a.attributes,f)&&(void 0==e&&(e=!0),CyberGIS.isString(b)&&CyberGIS.isString(c)&&CyberGIS.isArray(d)&&(a.attributes[""+b]=CyberGIS.grep(a.attributes[""+c],d,e)))},calc_count:function(a,b,c,d){if(void 0!=d){var e=void 0;e="="==d.op||"=="==d.op?$.grep(b,function(a,b){return a[""+d.field]==d.value}):"!="==d.op||"<>"==d.op?$.grep(b,function(a,b){return a[""+d.field]!=d.value}):"not in"==d.op||"notin"==d.op||"not_in"==d.op?$.grep(b,function(a,b){return-1==$.inArray(a[""+d.field],d.values)}):b,a.attributes[""+c]=e.length}else a.attributes[""+c]=b.length},calc_sum:function(a,b,c,d){for(var e=0,f=0;f<b.length;f++)e+=b[f][""+d];a.attributes[""+c]=e},calc_min:function(a,b,c,d){var e=void 0;if(b.length>0){e=b[0][""+d];for(var f=1;f<b.length;f++)b[f][""+d]<e&&(e=b[f][""+d])}a.attributes[""+c]=e},calc_max:function(a,b,c,d){var e=void 0;if(b.length>0){e=b[0][""+d];for(var f=1;f<b.length;f++)b[f][""+d]>e&&(e=b[f][""+d])}a.attributes[""+c]=e},calc_avg:function(a,b,c,d){for(var e=0,f=0;f<b.length;f++)e+=b[f][""+d];a.attributes[""+c]=e/b.length},calc_strip_fields:function(a,b,c){if(CyberGIS.isString(c)&&CyberGIS.isArray(b))for(var d=a.attributes,e=0;e<b.length;e++)d[""+b[e]]=CyberGIS.strip(d[""+b[e]],c)},calc_strip_array:function(a,b,c,d,e,f,g,h){if(CyberGIS.isString(c)&&CyberGIS.isString(d)&&CyberGIS.isString(h))if(CyberGIS.isArray(e)){for(var i=[],j=0;j<b.length;j++){for(var k=b[j],l=CyberGIS.extend({},k),m=0;m<e.length;m++)l[""+e[m]]=CyberGIS.strip(l[""+e[m]],h);i.push(l)}a.attributes[""+d]=i}else if(CyberGIS.isString(f)&&CyberGIS.isString(g)){for(var i=[],j=0;j<b.length;j++){var k=b[j],l=CyberGIS.extend({},k);l[""+g]=CyberGIS.strip(l[""+f],h),i.push(l)}a.attributes[""+d]=i}else a.attributes[""+d]=void 0;else a.attributes[""+d]=void 0},testFeature:function(a,b,c){return void 0!=b&&void 0!=c?"="==c.op||"=="==c.op?b[""+c.field]==c.value:"!="==c.op||"<>"==c.op?b[""+c.field]!=c.value:"not in"==c.op||"notin"==c.op||"not_in"==c.op?-1==$.inArray(b[""+c.field],c.values):"not in"==c.op||"notin"==c.op||"not_in"==c.op?-1==$.inArray(b[""+c.field],c.values):"intersects"==c.op?CyberGIS.isField(c.bbox)&&"map"==CyberGIS.extractField(c.bbox)?this.currentExtent.intersectsBounds(a.geometry.getBounds()):c.bbox.match(new RegExp(CyberGIS.regex_bbox))?new OpenLayers.Bounds.fromString(c.bbox).intersectsBounds(a.geometry.getBounds()):!0:!0:!0},attr:function(a,b){var c=a.name,d=a.type,e="";return e="string"==d?this.attr_s(c,b):"int"==d||"integer"==d?this.attr_int(c,b):"hashmap"==d?this.attr_hm(c,b,a.hashmap):"pcode"==d?this.attr_pc(c,b,a.pcode):this.attr_s(c,b)},attr_s:function(a,b){var c="Not Found!";return void 0!=b&&void 0!=b[""+a]&&(c=b[""+a]),c},attr_int:function(a,b){var c="Not Found!";if(void 0!=b&&void 0!=b[""+a]){var d=b[""+a];void 0!=d&&(d=$.trim(d),d.match(new RegExp("^([-+]?)(\\d+)$","gi"))&&(c=CyberGIS.Number.formatInteger(parseInt(d,10))))}return c},attr_hm:function(a,b,c){var d="Not Found!";return void 0!=b&&void 0!=b[""+a]&&(d=hiu.client.hashmaps[""+c.ns][""+c.id][b[""+a]]),d},attr_pc:function(a,b,c){var d="Not Found!";if(void 0!=b&&void 0!=b[""+a]){var e=c.level;if(void 0!=hiu.client.pcodes){var f=hiu.client.pcodes.getValue(e,b[""+a]);void 0!=f&&(d=f[""+c.label])}else d="No P-Codes Found for level "+e}return d},CLASS_NAME:"OpenLayers.Strategy.JIT"});